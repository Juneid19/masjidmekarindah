<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Masjid Mekarindah</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #1B5E20;
            --primary-light: #4CAF50;
            --primary-dark: #0D3D12;
            --gold: #D4AF37;
            --white: #ffffff;
            --light: #f5f5f5;
            --gray: #666;
            --dark: #333;
            --danger: #f44336;
            --warning: #ff9800;
            --success: #4CAF50;
            --sidebar-width: 260px;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { overflow-y: scroll; overflow-x: hidden; }
        body { font-family: 'Poppins', sans-serif; background: var(--light); color: var(--dark); line-height: 1.6; overflow-x: hidden; width: 100%; max-width: 100vw; }
        
        .login-screen { min-height: 100vh; display: flex; justify-content: center; align-items: center; background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%); padding: 20px; }
        .login-box { background: var(--white); padding: 40px; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); width: 100%; max-width: 400px; text-align: center; }
        .login-box .logo { font-size: 4rem; color: var(--primary); margin-bottom: 10px; }
        .login-box h1 { color: var(--primary); margin-bottom: 5px; font-size: 1.5rem; }
        .login-box .subtitle { color: var(--gray); margin-bottom: 30px; font-size: 0.9rem; }
        
        .form-group { margin-bottom: 20px; text-align: left; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 500; color: var(--dark); }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 12px 15px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 1rem; font-family: inherit; transition: all 0.3s; }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(27, 94, 32, 0.1); }
        .form-group textarea { min-height: 100px; resize: vertical; }
        
        .btn { padding: 12px 25px; border: none; border-radius: 10px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s; display: inline-flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-primary { background: var(--primary); color: var(--white); }
        .btn-primary:hover { background: var(--primary-dark); }
        .btn-success { background: var(--success); color: var(--white); }
        .btn-danger { background: var(--danger); color: var(--white); }
        .btn-warning { background: var(--warning); color: var(--white); }
        .btn-secondary { background: var(--gray); color: var(--white); }
        .btn-block { width: 100%; }
        .btn-sm { padding: 8px 15px; font-size: 0.85rem; }
        
        .login-error { background: #ffebee; color: var(--danger); padding: 10px; border-radius: 8px; margin-bottom: 20px; display: none; }
        .login-error.show { display: block; }
        
        .admin-container { display: flex; min-height: 100vh; width: 100%; max-width: 100vw; overflow-x: hidden; }
        
        .sidebar { width: var(--sidebar-width); background: linear-gradient(180deg, var(--primary) 0%, var(--primary-dark) 100%); color: var(--white); position: fixed; height: 100vh; overflow-y: auto; z-index: 1000; transition: transform 0.3s; }
        .sidebar-header { padding: 25px 20px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .sidebar-header i { font-size: 2.5rem; color: var(--gold); margin-bottom: 10px; display: block; }
        .sidebar-header h2 { font-size: 1.1rem; }
        .sidebar-header p { font-size: 0.8rem; opacity: 0.7; }
        .sidebar-menu { padding: 20px 0; }
        .menu-item { display: flex; align-items: center; padding: 15px 25px; color: rgba(255,255,255,0.8); text-decoration: none; transition: all 0.3s; cursor: pointer; border-left: 3px solid transparent; }
        .menu-item:hover { background: rgba(255,255,255,0.1); color: var(--white); }
        .menu-item.active { background: rgba(255,255,255,0.15); color: var(--white); border-left-color: var(--gold); }
        .menu-item i { width: 25px; margin-right: 12px; }
        .menu-item.logout { margin-top: 20px; border-top: 1px solid rgba(255,255,255,0.1); color: #ff8a80; }
        
        .main-content { flex: 1; margin-left: var(--sidebar-width); min-height: 100vh; width: calc(100% - var(--sidebar-width)); overflow-x: hidden; }
        
        .topbar { background: var(--white); padding: 20px 30px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 100; }
        .topbar h1 { font-size: 1.5rem; color: var(--primary); }
        .topbar-actions { display: flex; gap: 10px; align-items: center; }
        .mobile-toggle { display: none; background: var(--primary); color: white; border: none; padding: 10px 15px; border-radius: 8px; cursor: pointer; font-size: 1.2rem; }
        
        .content-area { padding: 30px; width: 100%; overflow-x: hidden; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .card { background: var(--white); border-radius: 15px; padding: 25px; margin-bottom: 25px; box-shadow: 0 5px 20px rgba(0,0,0,0.08); }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid var(--light); flex-wrap: wrap; gap: 15px; }
        .card-header h3 { color: var(--primary); display: flex; align-items: center; gap: 10px; }
        .card-header h3 i { color: var(--gold); }
        
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: var(--white); border-radius: 15px; padding: 20px; box-shadow: 0 5px 20px rgba(0,0,0,0.08); display: flex; align-items: center; gap: 15px; }
        .stat-card .icon { width: 50px; height: 50px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.3rem; color: var(--white); flex-shrink: 0; }
        .stat-card .icon.green { background: linear-gradient(135deg, #4CAF50, #2E7D32); }
        .stat-card .icon.blue { background: linear-gradient(135deg, #2196F3, #1565C0); }
        .stat-card .icon.orange { background: linear-gradient(135deg, #FF9800, #EF6C00); }
        .stat-card .icon.purple { background: linear-gradient(135deg, #9C27B0, #6A1B9A); }
        .stat-card .icon.red { background: linear-gradient(135deg, #f44336, #c62828); }
        .stat-card .icon.gold { background: linear-gradient(135deg, #D4AF37, #B8860B); }
        .stat-card .icon.teal { background: linear-gradient(135deg, #009688, #00695C); }
        .stat-card .info h4 { font-size: 1.5rem; color: var(--dark); }
        .stat-card .info p { color: var(--gray); font-size: 0.85rem; }
        
        .table-container { width: 100%; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; }
        table th, table td { padding: 12px; text-align: left; border-bottom: 1px solid var(--light); }
        table th { background: var(--light); font-weight: 600; color: var(--primary); }
        table img { width: 45px; height: 45px; border-radius: 50%; object-fit: cover; }
        .action-btns { display: flex; gap: 8px; }
        
        .badge { padding: 4px 10px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; }
        .badge-success { background: #e8f5e9; color: #2e7d32; }
        .badge-danger { background: #ffebee; color: #c62828; }
        .badge-info { background: #e3f2fd; color: #1565c0; }
        .badge-dark { background: #333; color: #fff; }
        
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .form-grid.cols-3 { grid-template-columns: repeat(3, 1fr); }
        .form-full { grid-column: 1 / -1; }
        
        .misi-list { display: flex; flex-direction: column; gap: 10px; }
        .misi-item { display: flex; gap: 10px; }
        .misi-item input { flex: 1; }
        
        .kajian-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; }
        .kajian-card { background: var(--light); border-radius: 12px; padding: 20px; border-left: 4px solid var(--gold); }
        .kajian-card h4 { color: var(--primary); margin-bottom: 15px; }
        
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; z-index: 2000; padding: 20px; }
        .modal-overlay.active { display: flex; }
        .modal { background: var(--white); border-radius: 20px; width: 100%; max-width: 500px; max-height: 90vh; overflow-y: auto; }
        .modal-header { padding: 20px; background: var(--primary); color: var(--white); border-radius: 20px 20px 0 0; display: flex; justify-content: space-between; align-items: center; }
        .modal-close { background: none; border: none; color: var(--white); font-size: 1.5rem; cursor: pointer; }
        .modal-body { padding: 20px; }
        .modal-footer { padding: 20px; border-top: 1px solid var(--light); display: flex; justify-content: flex-end; gap: 10px; }
        
        .loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.9); display: flex; justify-content: center; align-items: center; z-index: 9999; flex-direction: column; gap: 20px; }
        .loading-overlay.hidden { display: none; }
        .spinner { width: 50px; height: 50px; border: 4px solid var(--light); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .notification { position: fixed; top: 20px; right: 20px; padding: 15px 25px; border-radius: 10px; color: white; font-weight: 500; z-index: 9999; transform: translateX(400px); transition: transform 0.3s; }
        .notification.show { transform: translateX(0); }
        .notification.success { background: var(--success); }
        .notification.error { background: var(--danger); }
        .notification.warning { background: var(--warning); }
        
        .sync-status { padding: 6px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 500; }
        .sync-status.online { background: #e8f5e9; color: #2e7d32; }
        .sync-status.offline { background: #ffebee; color: #c62828; }
        
        .sidebar-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 999; display: none; }
        .sidebar-overlay.active { display: block; }
        
        @media (max-width: 992px) {
            .sidebar { transform: translateX(-100%); }
            .sidebar.active { transform: translateX(0); }
            .main-content { margin-left: 0; width: 100%; }
            .mobile-toggle { display: block; }
            .form-grid.cols-3 { grid-template-columns: 1fr; }
        }
        
        @media (max-width: 768px) {
            .topbar { padding: 12px 15px; flex-wrap: wrap; gap: 10px; }
            .topbar h1 { font-size: 1rem; }
            .topbar-actions { width: 100%; justify-content: space-between; }
            .content-area { padding: 15px 10px; }
            .stats-grid { grid-template-columns: 1fr 1fr; gap: 10px; }
            .stat-card { padding: 12px; flex-direction: column; text-align: center; gap: 8px; }
            .stat-card .icon { width: 40px; height: 40px; font-size: 1rem; }
            .stat-card .info h4 { font-size: 1.1rem; }
            .stat-card .info p { font-size: 0.7rem; }
            .card { padding: 15px; }
            .card-header { flex-direction: column; align-items: stretch; }
            .card-header .btn { width: 100%; }
            .form-grid { grid-template-columns: 1fr; }
            .kajian-grid { grid-template-columns: 1fr; }
            .modal { margin: 10px; }
            .modal-footer { flex-direction: column; }
            .modal-footer .btn { width: 100%; }
            .misi-item { flex-direction: column; }
            .table-container { overflow: visible; }
            table, thead, tbody, tr, th, td { display: block; }
            thead { display: none; }
            tbody { display: flex; flex-direction: column; gap: 12px; }
            tr { background: var(--light); border-radius: 12px; padding: 15px; border: 1px solid #e0e0e0; }
            td { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border: none; border-bottom: 1px solid #eee; gap: 10px; }
            td:last-child { border-bottom: none; padding-top: 12px; }
            td::before { content: attr(data-label); font-weight: 600; color: var(--primary); font-size: 0.8rem; }
            td:last-child::before { display: none; }
            .action-btns { width: 100%; }
            .action-btns .btn { flex: 1; padding: 10px; }
        }
        
        @media (max-width: 480px) {
            .stats-grid { grid-template-columns: 1fr; }
            .btn-sm { padding: 6px 10px; font-size: 0.75rem; }
        }
    </style>
</head>
<body>
    <div class="loading-overlay hidden" id="loadingOverlay">
        <div class="spinner"></div>
        <p>Memuat data...</p>
    </div>
    
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notificationText">Berhasil!</span>
    </div>

    <div class="login-screen" id="loginScreen">
        <div class="login-box">
            <div class="logo"><i class="fas fa-mosque"></i></div>
            <h1>Admin Panel</h1>
            <p class="subtitle">Masjid Mekarindah</p>
            <div class="login-error" id="loginError">
                <i class="fas fa-exclamation-circle"></i> Username atau password salah!
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label><i class="fas fa-user"></i> Username</label>
                    <input type="text" id="loginUsername" placeholder="Masukkan username" required>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-lock"></i> Password</label>
                    <input type="password" id="loginPassword" placeholder="Masukkan password" required>
                </div>
                <button type="submit" class="btn btn-primary btn-block">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
            </form>
            <p style="margin-top: 20px; font-size: 0.85rem;">
                <a href="index.html" style="color: var(--primary);"><i class="fas fa-arrow-left"></i> Kembali ke Website</a>
            </p>
        </div>
    </div>

    <div class="admin-container" id="adminContainer" style="display: none;">
        <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>
        
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <i class="fas fa-mosque"></i>
                <h2>Masjid Mekarindah</h2>
                <p>Admin Panel</p>
            </div>
            <nav class="sidebar-menu">
                <div class="menu-item active" data-tab="dashboard" onclick="switchTab('dashboard')"><i class="fas fa-tachometer-alt"></i> Dashboard</div>
                <div class="menu-item" data-tab="pengaturan" onclick="switchTab('pengaturan')"><i class="fas fa-cog"></i> Pengaturan</div>
                <div class="menu-item" data-tab="jadwal-sholat" onclick="switchTab('jadwal-sholat')"><i class="fas fa-clock"></i> Jadwal Sholat</div>
                <div class="menu-item" data-tab="pengurus" onclick="switchTab('pengurus')"><i class="fas fa-users"></i> Pengurus</div>
                <div class="menu-item" data-tab="kajian" onclick="switchTab('kajian')"><i class="fas fa-book-open"></i> Jadwal Kajian</div>
                <div class="menu-item" data-tab="keuangan" onclick="switchTab('keuangan')"><i class="fas fa-chart-pie"></i> Keuangan</div>
                <div class="menu-item" data-tab="zakat" onclick="switchTab('zakat')"><i class="fas fa-hand-holding-usd"></i> Zakat</div>
                <div class="menu-item" data-tab="kisah" onclick="switchTab('kisah')"><i class="fas fa-heart"></i> Kisah Inspiratif</div>
                <div class="menu-item" data-tab="donasi" onclick="switchTab('donasi')"><i class="fas fa-hand-holding-heart"></i> Donasi</div>
                <div class="menu-item" data-tab="galeri" onclick="switchTab('galeri')"><i class="fas fa-images"></i> Galeri</div>
                <div class="menu-item" data-tab="pengumuman" onclick="switchTab('pengumuman')"><i class="fas fa-bullhorn"></i> Pengumuman</div>
                <div class="menu-item logout" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</div>
            </nav>
        </aside>
        
        <main class="main-content">
            <div class="topbar">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <button class="mobile-toggle" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>
                    <h1 id="pageTitle">Dashboard</h1>
                </div>
                <div class="topbar-actions">
                    <div class="sync-status online" id="syncStatus"><i class="fas fa-circle"></i> Online</div>
                    <a href="index.html" target="_blank" class="btn btn-primary btn-sm"><i class="fas fa-external-link-alt"></i> Lihat Web</a>
                </div>
            </div>
            
            <div class="content-area">
                <!-- DASHBOARD -->
                <div class="tab-content active" id="tab-dashboard">
                    <div class="stats-grid" id="statsGrid"></div>
                    <div class="card">
                        <div class="card-header"><h3><i class="fas fa-info-circle"></i> Informasi</h3></div>
                        <p>Selamat datang di Admin Panel Masjid Mekarindah!</p>
                        <p style="margin-top:10px; background:#e8f5e9; padding:15px; border-radius:10px;">
                            <i class="fas fa-cloud"></i> <strong>Data tersimpan di Cloud!</strong><br>
                            Semua perubahan tersinkronisasi ke semua perangkat.
                        </p>
                    </div>
                </div>
                
                <!-- PENGATURAN -->
                <div class="tab-content" id="tab-pengaturan">
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-cog"></i> Pengaturan Website</h3>
                            <button class="btn btn-success" onclick="savePengaturan()"><i class="fas fa-save"></i> Simpan</button>
                        </div>
                        <div class="form-grid">
                            <div class="form-group"><label>Nama Masjid</label><input type="text" id="settingNama"></div>
                            <div class="form-group"><label>Alamat</label><input type="text" id="settingAlamat"></div>
                            <div class="form-group form-full"><label>Deskripsi</label><textarea id="settingDeskripsi"></textarea></div>
                            <div class="form-group form-full"><label>Visi</label><textarea id="settingVisi"></textarea></div>
                            <div class="form-group form-full">
                                <label>Misi</label>
                                <div class="misi-list" id="misiList"></div>
                                <button class="btn btn-primary btn-sm" style="margin-top:10px;" onclick="addMisi()"><i class="fas fa-plus"></i> Tambah Misi</button>
                            </div>
                            <div class="form-group"><label>Foto Masjid (URL)</label><input type="url" id="settingFoto" placeholder="https://i.ibb.co/..."></div>
                            <div class="form-group"><label>Facebook</label><input type="url" id="settingFacebook"></div>
                            <div class="form-group"><label>Instagram</label><input type="url" id="settingInstagram"></div>
                            <div class="form-group"><label>YouTube</label><input type="url" id="settingYoutube"></div>
                            <div class="form-group"><label>WhatsApp</label><input type="text" id="settingWhatsapp" placeholder="6281234567890"></div>
                        </div>
                    </div>
                </div>
                
                <!-- JADWAL SHOLAT -->
                <div class="tab-content" id="tab-jadwal-sholat">
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-clock"></i> Jadwal Sholat (Backup)</h3>
                            <button class="btn btn-success" onclick="saveJadwalSholat()"><i class="fas fa-save"></i> Simpan</button>
                        </div>
                        <p style="background:#fff3e0; padding:15px; border-radius:10px; margin-bottom:20px;">
                            <i class="fas fa-info-circle"></i> Jadwal utama dari API. Ini backup jika API error.
                        </p>
                        <div class="form-grid cols-3">
                            <div class="form-group"><label>Subuh</label><input type="time" id="jadwalSubuh"></div>
                            <div class="form-group"><label>Dzuhur</label><input type="time" id="jadwalDzuhur"></div>
                            <div class="form-group"><label>Ashar</label><input type="time" id="jadwalAshar"></div>
                            <div class="form-group"><label>Maghrib</label><input type="time" id="jadwalMaghrib"></div>
                            <div class="form-group"><label>Isya</label><input type="time" id="jadwalIsya"></div>
                        </div>
                    </div>
                </div>
                
                <!-- PENGURUS -->
                <div class="tab-content" id="tab-pengurus">
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-users"></i> Daftar Pengurus</h3>
                            <button class="btn btn-primary" onclick="openPengurusModal()"><i class="fas fa-plus"></i> Tambah</button>
                        </div>
                        <div class="table-container">
                            <table><thead><tr><th>Foto</th><th>Nama</th><th>Jabatan</th><th>Kategori</th><th>Aksi</th></tr></thead><tbody id="pengurusTable"></tbody></table>
                        </div>
                    </div>
                </div>
                
                <!-- KAJIAN -->
                <div class="tab-content" id="tab-kajian">
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-book-open"></i> Jadwal Kajian</h3>
                            <button class="btn btn-success" onclick="saveKajian()"><i class="fas fa-save"></i> Simpan</button>
                        </div>
                        <div class="kajian-grid" id="kajianForm"></div>
                    </div>
                </div>
                
                <!-- KEUANGAN -->
                <div class="tab-content" id="tab-keuangan">
                    <div class="stats-grid" id="keuanganStats"></div>
                    <div class="card">
                        <div class="card-header"><h3><i class="fas fa-wallet"></i> Saldo Awal</h3></div>
                        <div class="form-grid">
                            <div class="form-group"><label>Saldo Awal (Rp)</label><input type="number" id="saldoAwal" placeholder="0"></div>
                            <div class="form-group" style="align-self:end;"><button class="btn btn-success" onclick="saveSaldoAwal()"><i class="fas fa-save"></i> Simpan</button></div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-list"></i> Transaksi</h3>
                            <button class="btn btn-primary" onclick="openKeuanganModal()"><i class="fas fa-plus"></i> Tambah</button>
                        </div>
                        <div class="table-container">
                            <table><thead><tr><th>Tanggal</th><th>Keterangan</th><th>Jenis</th><th>Jumlah</th><th>Aksi</th></tr></thead><tbody id="keuanganTable"></tbody></table>
                        </div>
                    </div>
                </div>
                
                <!-- ZAKAT -->
                <div class="tab-content" id="tab-zakat">
                    <div class="stats-grid" id="zakatStats"></div>
                    <div class="card">
                        <div class="card-header"><h3><i class="fas fa-wallet"></i> Saldo Awal Zakat</h3></div>
                        <div class="form-grid">
                            <div class="form-group"><label>Saldo Awal (Rp)</label><input type="number" id="saldoAwalZakat" placeholder="0"></div>
                            <div class="form-group" style="align-self:end;"><button class="btn btn-success" onclick="saveSaldoAwalZakat()"><i class="fas fa-save"></i> Simpan</button></div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-list"></i> Transaksi Zakat</h3>
                            <button class="btn btn-primary" onclick="openZakatModal()"><i class="fas fa-plus"></i> Tambah</button>
                        </div>
                        <div class="table-container">
                            <table><thead><tr><th>Tanggal</th><th>Keterangan</th><th>Jenis</th><th>Jumlah</th><th>Aksi</th></tr></thead><tbody id="zakatTable"></tbody></table>
                        </div>
                    </div>
                </div>
                
                <!-- KISAH -->
                <div class="tab-content" id="tab-kisah">
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-heart"></i> Kisah Inspiratif</h3>
                            <button class="btn btn-primary" onclick="openKisahModal()"><i class="fas fa-plus"></i> Tambah</button>
                        </div>
                        <div class="table-container">
                            <table><thead><tr><th>Gambar</th><th>Judul</th><th>Isi</th><th>Aksi</th></tr></thead><tbody id="kisahTable"></tbody></table>
                        </div>
                    </div>
                </div>
                
                <!-- DONASI -->
                <div class="tab-content" id="tab-donasi">
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-hand-holding-heart"></i> Info Donasi</h3>
                            <button class="btn btn-primary" onclick="openDonasiModal()"><i class="fas fa-plus"></i> Tambah</button>
                        </div>
                        <div class="table-container">
                            <table><thead><tr><th>Bank</th><th>No. Rekening</th><th>Atas Nama</th><th>Aksi</th></tr></thead><tbody id="donasiTable"></tbody></table>
                        </div>
                    </div>
                </div>
                
                <!-- GALERI -->
                <div class="tab-content" id="tab-galeri">
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-images"></i> Galeri</h3>
                            <button class="btn btn-primary" onclick="openGaleriModal()"><i class="fas fa-plus"></i> Tambah</button>
                        </div>
                        <div class="table-container">
                            <table><thead><tr><th>Preview</th><th>Tipe</th><th>Caption</th><th>Aksi</th></tr></thead><tbody id="galeriTable"></tbody></table>
                        </div>
                    </div>
                </div>
                
                <!-- PENGUMUMAN -->
                <div class="tab-content" id="tab-pengumuman">
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-bullhorn"></i> Pengumuman</h3>
                            <button class="btn btn-primary" onclick="openPengumumanModal()"><i class="fas fa-plus"></i> Tambah</button>
                        </div>
                        <div class="table-container">
                            <table><thead><tr><th>Tanggal</th><th>Judul</th><th>Status</th><th>Aksi</th></tr></thead><tbody id="pengumumanTable"></tbody></table>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- MODALS -->
    <div class="modal-overlay" id="modalPengurus">
        <div class="modal">
            <div class="modal-header">
                <h3><i class="fas fa-user-plus"></i> <span id="modalPengurusTitle">Tambah Pengurus</span></h3>
                <button class="modal-close" onclick="closeModal('modalPengurus')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="pengurusId">
                <div class="form-group"><label>Nama</label><input type="text" id="pengurusNama"></div>
                <div class="form-group"><label>Jabatan</label><input type="text" id="pengurusJabatan"></div>
                <div class="form-group"><label>Kategori</label><select id="pengurusKategori"><option value="Yayasan">Yayasan</option><option value="DKM">DKM</option><option value="Majlis Taklim">Majlis Taklim</option></select></div>
                <div class="form-group"><label>URL Foto</label><input type="url" id="pengursFoto"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('modalPengurus')">Batal</button>
                <button class="btn btn-success" onclick="savePengurus()"><i class="fas fa-save"></i> Simpan</button>
            </div>
        </div>
    </div>
    
    <div class="modal-overlay" id="modalKeuangan">
        <div class="modal">
            <div class="modal-header">
                <h3><i class="fas fa-money-bill"></i> <span id="modalKeuanganTitle">Tambah Transaksi</span></h3>
                <button class="modal-close" onclick="closeModal('modalKeuangan')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="keuanganId">
                <div class="form-group"><label>Tanggal</label><input type="date" id="keuanganTanggal"></div>
                <div class="form-group"><label>Jenis</label><select id="keuanganJenis"><option value="pemasukan">Pemasukan</option><option value="pengeluaran">Pengeluaran</option></select></div>
                <div class="form-group"><label>Jumlah (Rp)</label><input type="number" id="keuanganJumlah"></div>
                <div class="form-group"><label>Keterangan</label><textarea id="keuanganKeterangan"></textarea></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('modalKeuangan')">Batal</button>
                <button class="btn btn-success" onclick="saveKeuangan()"><i class="fas fa-save"></i> Simpan</button>
            </div>
        </div>
    </div>
    
    <div class="modal-overlay" id="modalZakat">
        <div class="modal">
            <div class="modal-header">
                <h3><i class="fas fa-hand-holding-usd"></i> <span id="modalZakatTitle">Tambah Transaksi Zakat</span></h3>
                <button class="modal-close" onclick="closeModal('modalZakat')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="zakatId">
                <div class="form-group"><label>Tanggal</label><input type="date" id="zakatTanggal"></div>
                <div class="form-group"><label>Jenis</label><select id="zakatJenis"><option value="pemasukan">Pemasukan (Zakat Masuk)</option><option value="pengeluaran">Pengeluaran (Penyaluran)</option></select></div>
                <div class="form-group"><label>Jumlah (Rp)</label><input type="number" id="zakatJumlah"></div>
                <div class="form-group"><label>Keterangan</label><textarea id="zakatKeterangan" placeholder="Contoh: Zakat Fitrah dari Bapak Ahmad"></textarea></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('modalZakat')">Batal</button>
                <button class="btn btn-success" onclick="saveZakat()"><i class="fas fa-save"></i> Simpan</button>
            </div>
        </div>
    </div>
    
    <div class="modal-overlay" id="modalKisah">
        <div class="modal">
            <div class="modal-header">
                <h3><i class="fas fa-heart"></i> <span id="modalKisahTitle">Tambah Kisah</span></h3>
                <button class="modal-close" onclick="closeModal('modalKisah')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="kisahId">
                <div class="form-group"><label>Judul</label><input type="text" id="kisahJudul"></div>
                <div class="form-group"><label>URL Gambar</label><input type="url" id="kisahGambar"></div>
                <div class="form-group"><label>Isi Kisah</label><textarea id="kisahIsi" style="min-height:150px;"></textarea></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('modalKisah')">Batal</button>
                <button class="btn btn-success" onclick="saveKisah()"><i class="fas fa-save"></i> Simpan</button>
            </div>
        </div>
    </div>
    
    <div class="modal-overlay" id="modalDonasi">
        <div class="modal">
            <div class="modal-header">
                <h3><i class="fas fa-university"></i> <span id="modalDonasiTitle">Tambah Rekening</span></h3>
                <button class="modal-close" onclick="closeModal('modalDonasi')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="donasiId">
                <div class="form-group"><label>Nama Bank</label><input type="text" id="donasiBank"></div>
                <div class="form-group"><label>Nomor Rekening</label><input type="text" id="donasiNoRek"></div>
                <div class="form-group"><label>Atas Nama</label><input type="text" id="donasiAtasNama"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('modalDonasi')">Batal</button>
                <button class="btn btn-success" onclick="saveDonasi()"><i class="fas fa-save"></i> Simpan</button>
            </div>
        </div>
    </div>
    
   <div class="modal-overlay" id="modalGaleri">
    <div class="modal">
        <div class="modal-header">
            <h3><i class="fas fa-image"></i> <span id="modalGaleriTitle">Tambah Media</span></h3>
            <button class="modal-close" onclick="closeModal('modalGaleri')"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="galeriId">
            <div class="form-group">
                <label>Tipe Media</label>
                <select id="galeriTipe" onchange="toggleGaleriInput()">
                    <option value="foto">ðŸ“· Foto</option>
                    <option value="youtube">ðŸŽ¬ Video YouTube</option>
                    <option value="instagram">ðŸ“¸ Instagram (Post/Reels)</option>
                    <option value="tiktok">ðŸŽµ TikTok</option>
                </select>
            </div>
            
            <!-- Foto Input -->
            <div class="form-group" id="galeriUrlGroup">
                <label>URL Foto</label>
                <input type="url" id="galeriUrl" placeholder="https://i.ibb.co/xxx/foto.jpg">
            </div>
            
            <!-- YouTube Input -->
            <div class="form-group" id="galeriYoutubeGroup" style="display:none;">
                <label>Link YouTube</label>
                <input type="text" id="galeriYoutubeId" placeholder="Paste link YouTube">
                <small style="color: #666; display: block; margin-top: 5px;">
                    Contoh: youtube.com/watch?v=xxx, youtu.be/xxx, youtube.com/shorts/xxx
                </small>
            </div>
            
            <!-- Instagram Input -->
            <div class="form-group" id="galeriInstagramGroup" style="display:none;">
                <label>Link Instagram (Post/Reels)</label>
                <input type="text" id="galeriInstagramId" placeholder="Paste link Instagram">
                <small style="color: #666; display: block; margin-top: 5px;">
                    Contoh: instagram.com/p/xxx, instagram.com/reel/xxx
                </small>
            </div>
            
            <!-- TikTok Input -->
            <div class="form-group" id="galeriTiktokGroup" style="display:none;">
                <label>Link TikTok</label>
                <input type="text" id="galeriTiktokId" placeholder="Paste link TikTok">
                <small style="color: #666; display: block; margin-top: 5px;">
                    Contoh: tiktok.com/@user/video/xxx, vm.tiktok.com/xxx
                </small>
            </div>
            
            <div class="form-group">
                <label>Caption</label>
                <input type="text" id="galeriCaption" placeholder="Keterangan gambar/video">
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeModal('modalGaleri')">Batal</button>
            <button class="btn btn-success" onclick="saveGaleri()"><i class="fas fa-save"></i> Simpan</button>
        </div>
    </div>
</div>
    
    <div class="modal-overlay" id="modalPengumuman">
        <div class="modal">
            <div class="modal-header">
                <h3><i class="fas fa-bullhorn"></i> <span id="modalPengumumanTitle">Tambah Pengumuman</span></h3>
                <button class="modal-close" onclick="closeModal('modalPengumuman')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="pengumumanId">
                <div class="form-group"><label>Tanggal</label><input type="date" id="pengumumanTanggal"></div>
                <div class="form-group"><label>Judul</label><input type="text" id="pengumumanJudul"></div>
                <div class="form-group"><label>Isi</label><textarea id="pengumumanIsi"></textarea></div>
                <div class="form-group"><label><input type="checkbox" id="pengumumanPenting"> Tandai PENTING</label></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('modalPengumuman')">Batal</button>
                <button class="btn btn-success" onclick="savePengumuman()"><i class="fas fa-save"></i> Simpan</button>
            </div>
        </div>
    </div>

    <script>
        // CONFIG - GANTI DENGAN MILIK ANDA
        const JSONBIN_BIN_ID = '695b57e0d0ea881f40552974';
        const JSONBIN_API_KEY = '$2a$10$mu94DGoU.bNfbEUgWcjffueeAaIQfeb2hMzp.TM.Tg6M8JiaUOIVm';
        const JSONBIN_URL = `https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}`;
        const ADMIN_USERNAME = 'admin';
        const ADMIN_PASSWORD = 'mekarindah2025';
        
        let masjidData = null;
        let currentTab = 'dashboard';
        
        const defaultData = {
            settings: { namaMasjid: "Masjid Mekarindah", alamat: "", deskripsi: "", visi: "", misi: [], fotoMasjid: "", facebook: "", instagram: "", youtube: "", whatsapp: "" },
            jadwalSholat: { subuh: "04:30", dzuhur: "12:00", ashar: "15:15", maghrib: "18:00", isya: "19:15" },
            pengurus: [],
            jadwalKajian: { senin: {}, selasa: {}, rabu: {}, kamis: {}, jumat: {}, sabtu: {}, ahad: {} },
            keuangan: { saldoAwal: 0, transaksi: [] },
            zakat: { saldoAwal: 0, transaksi: [] },
            kisahInspiratif: [],
            donasi: [{ id: 1, bank: "BSI", noRekening: "2022 112 212", atasNama: "Yayasan Islam Mekarindah" }],
            galeri: [],
            pengumuman: []
        };
        
        // INIT
        document.addEventListener('DOMContentLoaded', function() {
            if (sessionStorage.getItem('adminLoggedIn') === 'true') showAdmin();
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                handleLogin();
            });
        });
        
        function handleLogin() {
            const u = document.getElementById('loginUsername').value;
            const p = document.getElementById('loginPassword').value;
            if (u === ADMIN_USERNAME && p === ADMIN_PASSWORD) {
                sessionStorage.setItem('adminLoggedIn', 'true');
                showAdmin();
            } else {
                document.getElementById('loginError').classList.add('show');
                setTimeout(() => document.getElementById('loginError').classList.remove('show'), 3000);
            }
        }
        
        function showAdmin() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('adminContainer').style.display = 'flex';
            loadData();
        }
        
        function logout() {
            if (confirm('Yakin logout?')) {
                sessionStorage.removeItem('adminLoggedIn');
                location.reload();
            }
        }
        
        // DATA
        async function loadData() {
            showLoading(true);
            try {
                const res = await fetch(JSONBIN_URL + '/latest', { headers: { 'X-Master-Key': JSONBIN_API_KEY } });
                if (!res.ok) throw new Error('Gagal');
                const result = await res.json();
                masjidData = result.record;
                localStorage.setItem('masjidMekarindah', JSON.stringify(masjidData));
                updateSyncStatus(true);
            } catch (e) {
                const local = localStorage.getItem('masjidMekarindah');
                masjidData = local ? JSON.parse(local) : JSON.parse(JSON.stringify(defaultData));
                updateSyncStatus(false);
            }
            renderCurrentTab();
            showLoading(false);
        }
        
        async function saveData() {
            showLoading(true);
            try {
                const res = await fetch(JSONBIN_URL, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json', 'X-Master-Key': JSONBIN_API_KEY },
                    body: JSON.stringify(masjidData)
                });
                if (!res.ok) throw new Error('Gagal');
                localStorage.setItem('masjidMekarindah', JSON.stringify(masjidData));
                showNotification('Berhasil disimpan!', 'success');
                updateSyncStatus(true);
            } catch (e) {
                localStorage.setItem('masjidMekarindah', JSON.stringify(masjidData));
                showNotification('Offline: Disimpan lokal', 'warning');
                updateSyncStatus(false);
            }
            showLoading(false);
        }
        
        function updateSyncStatus(online) {
            const s = document.getElementById('syncStatus');
            s.className = 'sync-status ' + (online ? 'online' : 'offline');
            s.innerHTML = '<i class="fas fa-circle"></i> ' + (online ? 'Online' : 'Offline');
        }
        
        // UI
        function showLoading(show) { document.getElementById('loadingOverlay').classList.toggle('hidden', !show); }
        
        function showNotification(msg, type) {
            const n = document.getElementById('notification');
            n.className = 'notification ' + type + ' show';
            document.getElementById('notificationText').textContent = msg;
            setTimeout(() => n.classList.remove('show'), 3000);
        }
        
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
            document.getElementById('sidebarOverlay').classList.toggle('active');
        }
        
        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
            document.querySelector(`.menu-item[data-tab="${tab}"]`).classList.add('active');
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.getElementById('tab-' + tab).classList.add('active');
            const titles = { 'dashboard': 'Dashboard', 'pengaturan': 'Pengaturan', 'jadwal-sholat': 'Jadwal Sholat', 'pengurus': 'Pengurus', 'kajian': 'Jadwal Kajian', 'keuangan': 'Keuangan', 'zakat': 'Laporan Zakat', 'kisah': 'Kisah Inspiratif', 'donasi': 'Donasi', 'galeri': 'Galeri', 'pengumuman': 'Pengumuman' };
            document.getElementById('pageTitle').textContent = titles[tab];
            document.getElementById('sidebar').classList.remove('active');
            document.getElementById('sidebarOverlay').classList.remove('active');
            renderCurrentTab();
        }
        
        function renderCurrentTab() {
            if (!masjidData) return;
            const renders = { dashboard: renderDashboard, pengaturan: renderPengaturan, 'jadwal-sholat': renderJadwalSholat, pengurus: renderPengurus, kajian: renderKajian, keuangan: renderKeuangan, zakat: renderZakat, kisah: renderKisah, donasi: renderDonasi, galeri: renderGaleri, pengumuman: renderPengumuman };
            if (renders[currentTab]) renders[currentTab]();
        }
        
        function closeModal(id) { document.getElementById(id).classList.remove('active'); }
        
        // HELPERS
        function formatNumber(n) { return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, "."); }
        function formatDate(d) { if (!d) return '-'; return new Date(d).toLocaleDateString('id-ID', { day: 'numeric', month: 'short', year: 'numeric' }); }
        function truncate(s, l) { return s && s.length > l ? s.substring(0, l) + '...' : (s || ''); }
        
        // RENDER DASHBOARD
        function renderDashboard() {
            const s = document.getElementById('statsGrid');
            const pc = (masjidData.pengurus || []).length;
            const gc =  (masjidData.galeri || []).length;
            const ac = (masjidData.pengumuman || []).length;
            const kc = (masjidData.kisahInspiratif || []).length;
            const keu = masjidData.keuangan || {};
            let saldo = keu.saldoAwal || 0;
            (keu.transaksi || []).forEach(t => { saldo += t.jenis === 'pemasukan' ? t.jumlah : -t.jumlah; });
            const zak = masjidData.zakat || {};
            let saldoZakat = zak.saldoAwal || 0;
            (zak.transaksi || []).forEach(t => { saldoZakat += t.jenis === 'pemasukan' ? t.jumlah : -t.jumlah; });
            s.innerHTML = `
                <div class="stat-card"><div class="icon green"><i class="fas fa-users"></i></div><div class="info"><h4>${pc}</h4><p>Pengurus</p></div></div>
                <div class="stat-card"><div class="icon blue"><i class="fas fa-images"></i></div><div class="info"><h4>${gc}</h4><p>Galeri</p></div></div>
                <div class="stat-card"><div class="icon orange"><i class="fas fa-bullhorn"></i></div><div class="info"><h4>${ac}</h4><p>Pengumuman</p></div></div>
                <div class="stat-card"><div class="icon purple"><i class="fas fa-heart"></i></div><div class="info"><h4>${kc}</h4><p>Kisah</p></div></div>
                <div class="stat-card"><div class="icon gold"><i class="fas fa-wallet"></i></div><div class="info"><h4>Rp ${formatNumber(saldo)}</h4><p>Saldo Kas</p></div></div>
                <div class="stat-card"><div class="icon teal"><i class="fas fa-hand-holding-usd"></i></div><div class="info"><h4>Rp ${formatNumber(saldoZakat)}</h4><p>Saldo Zakat</p></div></div>
            `;
        }
        
        // RENDER PENGATURAN
        function renderPengaturan() {
            const s = masjidData.settings || {};
            document.getElementById('settingNama').value = s.namaMasjid || '';
            document.getElementById('settingAlamat').value = s.alamat || '';
            document.getElementById('settingDeskripsi').value = s.deskripsi || '';
            document.getElementById('settingVisi').value = s.visi || '';
            document.getElementById('settingFoto').value = s.fotoMasjid || '';
            document.getElementById('settingFacebook').value = s.facebook || '';
            document.getElementById('settingInstagram').value = s.instagram || '';
            document.getElementById('settingYoutube').value = s.youtube || '';
            document.getElementById('settingWhatsapp').value = s.whatsapp || '';
            const ml = document.getElementById('misiList');
            ml.innerHTML = (s.misi || []).map((m, i) => `<div class="misi-item"><input type="text" value="${m}" onchange="updateMisi(${i}, this.value)"><button class="btn btn-danger btn-sm" onclick="removeMisi(${i})"><i class="fas fa-trash"></i></button></div>`).join('');
        }
        
        function addMisi() { if (!masjidData.settings) masjidData.settings = {}; if (!masjidData.settings.misi) masjidData.settings.misi = []; masjidData.settings.misi.push(''); renderPengaturan(); }
        function updateMisi(i, v) { masjidData.settings.misi[i] = v; }
        function removeMisi(i) { masjidData.settings.misi.splice(i, 1); renderPengaturan(); }
        function savePengaturan() {
            masjidData.settings = { ...masjidData.settings, namaMasjid: document.getElementById('settingNama').value, alamat: document.getElementById('settingAlamat').value, deskripsi: document.getElementById('settingDeskripsi').value, visi: document.getElementById('settingVisi').value, fotoMasjid: document.getElementById('settingFoto').value, facebook: document.getElementById('settingFacebook').value, instagram: document.getElementById('settingInstagram').value, youtube: document.getElementById('settingYoutube').value, whatsapp: document.getElementById('settingWhatsapp').value };
            saveData();
        }
        
        // RENDER JADWAL SHOLAT
        function renderJadwalSholat() {
            const j = masjidData.jadwalSholat || {};
            document.getElementById('jadwalSubuh').value = j.subuh || '04:30';
            document.getElementById('jadwalDzuhur').value = j.dzuhur || '12:00';
            document.getElementById('jadwalAshar').value = j.ashar || '15:15';
            document.getElementById('jadwalMaghrib').value = j.maghrib || '18:00';
            document.getElementById('jadwalIsya').value = j.isya || '19:15';
        }
        
        function saveJadwalSholat() {
            masjidData.jadwalSholat = { subuh: document.getElementById('jadwalSubuh').value, dzuhur: document.getElementById('jadwalDzuhur').value, ashar: document.getElementById('jadwalAshar').value, maghrib: document.getElementById('jadwalMaghrib').value, isya: document.getElementById('jadwalIsya').value };
            saveData();
        }
        
        // RENDER PENGURUS
        function renderPengurus() {
            const t = document.getElementById('pengurusTable');
            const p = masjidData.pengurus || [];
            t.innerHTML = p.map((x, i) => `<tr><td data-label="Foto"><img src="${x.foto || 'https://via.placeholder.com/45'}"></td><td data-label="Nama">${x.nama}</td><td data-label="Jabatan">${x.jabatan}</td><td data-label="Kategori"><span class="badge badge-info">${x.kategori}</span></td><td><div class="action-btns"><button class="btn btn-warning btn-sm" onclick="editPengurus(${i})"><i class="fas fa-edit"></i></button><button class="btn btn-danger btn-sm" onclick="deletePengurus(${i})"><i class="fas fa-trash"></i></button></div></td></tr>`).join('') || '<tr><td colspan="5">Belum ada data</td></tr>';
        }
        
        function openPengurusModal(i = null) {
            document.getElementById('modalPengurusTitle').textContent = i !== null ? 'Edit Pengurus' : 'Tambah Pengurus';
            document.getElementById('pengurusId').value = i !== null ? i : '';
            if (i !== null) { const p = masjidData.pengurus[i]; document.getElementById('pengurusNama').value = p.nama; document.getElementById('pengurusJabatan').value = p.jabatan; document.getElementById('pengurusKategori').value = p.kategori; document.getElementById('pengursFoto').value = p.foto || ''; }
            else { document.getElementById('pengurusNama').value = ''; document.getElementById('pengurusJabatan').value = ''; document.getElementById('pengurusKategori').value = 'DKM'; document.getElementById('pengursFoto').value = ''; }
            document.getElementById('modalPengurus').classList.add('active');
        }
        
        function editPengurus(i) { openPengurusModal(i); }
        
        function savePengurus() {
            const id = document.getElementById('pengurusId').value;
            const data = { nama: document.getElementById('pengurusNama').value, jabatan: document.getElementById('pengurusJabatan').value, kategori: document.getElementById('pengurusKategori').value, foto: document.getElementById('pengursFoto').value };
            if (!data.nama) { showNotification('Nama wajib diisi!', 'error'); return; }
            if (!masjidData.pengurus) masjidData.pengurus = [];
            if (id !== '') masjidData.pengurus[parseInt(id)] = data; else masjidData.pengurus.push(data);
            closeModal('modalPengurus'); saveData(); renderPengurus();
        }
        
        function deletePengurus(i) { if (confirm('Hapus pengurus ini?')) { masjidData.pengurus.splice(i, 1); saveData(); renderPengurus(); } }
        
        // RENDER KAJIAN
        function renderKajian() {
            const f = document.getElementById('kajianForm');
            const k = masjidData.jadwalKajian || {};
            const days = ['senin', 'selasa', 'rabu', 'kamis', 'jumat', 'sabtu', 'ahad'];
            const labels = { senin: 'Senin', selasa: 'Selasa', rabu: 'Rabu', kamis: 'Kamis', jumat: 'Jumat', sabtu: 'Sabtu', ahad: 'Ahad' };
            f.innerHTML = days.map(d => { const x = k[d] || {}; return `<div class="kajian-card"><h4><i class="fas fa-calendar-day"></i> ${labels[d]}</h4><div class="form-group"><label>Nama</label><input type="text" id="kajian_${d}_nama" value="${x.nama || ''}"></div><div class="form-group"><label>Waktu</label><input type="text" id="kajian_${d}_waktu" value="${x.waktu || ''}"></div><div class="form-group"><label>Pemateri</label><input type="text" id="kajian_${d}_pemateri" value="${x.pemateri || ''}"></div><div class="form-group"><label>Link Video</label><input type="url" id="kajian_${d}_video" value="${x.linkVideo || ''}"></div><div class="form-group"><label>Link Audio</label><input type="url" id="kajian_${d}_audio" value="${x.linkAudio || ''}"></div></div>`; }).join('');
        }
        
        function saveKajian() {
            const days = ['senin', 'selasa', 'rabu', 'kamis', 'jumat', 'sabtu', 'ahad'];
            masjidData.jadwalKajian = {};
            days.forEach(d => { masjidData.jadwalKajian[d] = { nama: document.getElementById(`kajian_${d}_nama`).value, waktu: document.getElementById(`kajian_${d}_waktu`).value, pemateri: document.getElementById(`kajian_${d}_pemateri`).value, linkVideo: document.getElementById(`kajian_${d}_video`).value, linkAudio: document.getElementById(`kajian_${d}_audio`).value }; });
            saveData();
        }
        
        // RENDER KEUANGAN
        function renderKeuangan() {
    // Fix struktur jika rusak
    if (!masjidData.keuangan) {
        masjidData.keuangan = { saldoAwal: 0, transaksi: [] };
    }
    if (Array.isArray(masjidData.keuangan)) {
        masjidData.keuangan = { saldoAwal: 0, transaksi: [] };
    }
    
    var keu = masjidData.keuangan;
    var tr = [];
    if (keu.transaksi) { tr = keu.transaksi; }
    
    var sa = 0;
    if (keu.saldoAwal) { sa = keu.saldoAwal; }
    
    var tp = 0;
    var tk = 0;
    
    for (var i = 0; i < tr.length; i++) {
        var t = tr[i];
        if (t && t.jenis === 'pemasukan') {
            tp = tp + (t.jumlah ? t.jumlah : 0);
        } else if (t) {
            tk = tk + (t.jumlah ? t.jumlah : 0);
        }
    }
    
    var saldo = sa + tp - tk;
    
    var statsEl = document.getElementById('keuanganStats');
    if (statsEl) {
        var statsHTML = '';
        statsHTML = statsHTML + '<div class="stat-card"><div class="icon green"><i class="fas fa-arrow-down"></i></div><div class="info"><h4>Rp ' + formatNumber(tp) + '</h4><p>Pemasukan</p></div></div>';
        statsHTML = statsHTML + '<div class="stat-card"><div class="icon red"><i class="fas fa-arrow-up"></i></div><div class="info"><h4>Rp ' + formatNumber(tk) + '</h4><p>Pengeluaran</p></div></div>';
        statsHTML = statsHTML + '<div class="stat-card"><div class="icon gold"><i class="fas fa-wallet"></i></div><div class="info"><h4>Rp ' + formatNumber(saldo) + '</h4><p>Saldo</p></div></div>';
        statsEl.innerHTML = statsHTML;
    }
    
    var saldoEl = document.getElementById('saldoAwal');
    if (saldoEl) { saldoEl.value = sa; }
    
    var tableEl = document.getElementById('keuanganTable');
    if (tableEl) {
        var tableHTML = '';
        if (tr.length === 0) {
            tableHTML = '<tr><td colspan="5">Belum ada transaksi</td></tr>';
        } else {
            for (var j = 0; j < tr.length; j++) {
                var row = tr[j];
                var tgl = formatDate(row.tanggal);
                var ket = row.keterangan ? row.keterangan : '-';
                var jns = row.jenis ? row.jenis : 'pemasukan';
                var jml = row.jumlah ? row.jumlah : 0;
                var badgeClass = jns === 'pemasukan' ? 'badge-success' : 'badge-danger';
                
                tableHTML = tableHTML + '<tr>';
                tableHTML = tableHTML + '<td data-label="Tanggal">' + tgl + '</td>';
                tableHTML = tableHTML + '<td data-label="Keterangan">' + ket + '</td>';
                tableHTML = tableHTML + '<td data-label="Jenis"><span class="badge ' + badgeClass + '">' + jns + '</span></td>';
                tableHTML = tableHTML + '<td data-label="Jumlah">Rp ' + formatNumber(jml) + '</td>';
                tableHTML = tableHTML + '<td><div class="action-btns"><button class="btn btn-warning btn-sm" onclick="editKeuangan(' + j + ')"><i class="fas fa-edit"></i></button><button class="btn btn-danger btn-sm" onclick="deleteKeuangan(' + j + ')"><i class="fas fa-trash"></i></button></div></td>';
                tableHTML = tableHTML + '</tr>';
            }
        }
        tableEl.innerHTML = tableHTML;
    }
}
        
        function saveSaldoAwal() { 
    if (!masjidData.keuangan) {
        masjidData.keuangan = { saldoAwal: 0, transaksi: [] };
    }
    if (Array.isArray(masjidData.keuangan)) {
        masjidData.keuangan = { saldoAwal: 0, transaksi: [] };
    }
    if (!masjidData.keuangan.transaksi) {
        masjidData.keuangan.transaksi = [];
    }
    var saldoInput = document.getElementById('saldoAwal');
    var saldoValue = 0;
    if (saldoInput && saldoInput.value) {
        saldoValue = parseInt(saldoInput.value);
    }
    if (isNaN(saldoValue)) {
        saldoValue = 0;
    }
    masjidData.keuangan.saldoAwal = saldoValue;
    saveData(); 
    renderKeuangan(); 
}
        
        function openKeuanganModal(i = null) {
            document.getElementById('modalKeuanganTitle').textContent = i !== null ? 'Edit Transaksi' : 'Tambah Transaksi';
            document.getElementById('keuanganId').value = i !== null ? i : '';
            if (i !== null) { const t = masjidData.keuangan.transaksi[i]; document.getElementById('keuanganTanggal').value = t.tanggal; document.getElementById('keuanganJenis').value = t.jenis; document.getElementById('keuanganJumlah').value = t.jumlah; document.getElementById('keuanganKeterangan').value = t.keterangan; }
            else { document.getElementById('keuanganTanggal').value = new Date().toISOString().split('T')[0]; document.getElementById('keuanganJenis').value = 'pemasukan'; document.getElementById('keuanganJumlah').value = ''; document.getElementById('keuanganKeterangan').value = ''; }
            document.getElementById('modalKeuangan').classList.add('active');
        }
        
        function editKeuangan(i) { openKeuanganModal(i); }
        
        function saveKeuangan() {
    var idEl = document.getElementById('keuanganId');
    var tanggalEl = document.getElementById('keuanganTanggal');
    var jenisEl = document.getElementById('keuanganJenis');
    var jumlahEl = document.getElementById('keuanganJumlah');
    var ketEl = document.getElementById('keuanganKeterangan');
    
    var id = '';
    if (idEl) { id = idEl.value; }
    
    var tanggal = '';
    if (tanggalEl) { tanggal = tanggalEl.value; }
    
    var jenis = 'pemasukan';
    if (jenisEl) { jenis = jenisEl.value; }
    
    var jumlah = 0;
    if (jumlahEl && jumlahEl.value) { 
        jumlah = parseInt(jumlahEl.value); 
    }
    if (isNaN(jumlah)) { jumlah = 0; }
    
    var keterangan = '';
    if (ketEl) { keterangan = ketEl.value; }
    
    if (jumlah === 0) { 
        showNotification('Jumlah wajib diisi!', 'error'); 
        return; 
    }
    
    var data = { 
        tanggal: tanggal, 
        jenis: jenis, 
        jumlah: jumlah, 
        keterangan: keterangan 
    };
    
    // Fix struktur keuangan jika rusak
    if (!masjidData.keuangan) {
        masjidData.keuangan = { saldoAwal: 0, transaksi: [] };
    }
    if (Array.isArray(masjidData.keuangan)) {
        masjidData.keuangan = { saldoAwal: 0, transaksi: [] };
    }
    if (!masjidData.keuangan.transaksi) {
        masjidData.keuangan.transaksi = [];
    }
    if (!masjidData.keuangan.saldoAwal) {
        masjidData.keuangan.saldoAwal = 0;
    }
    
    if (id !== '' && id !== null && id !== undefined) {
        masjidData.keuangan.transaksi[parseInt(id)] = data;
    } else {
        masjidData.keuangan.transaksi.unshift(data);
    }
    
    closeModal('modalKeuangan'); 
    saveData(); 
    renderKeuangan();
}
        
        function deleteKeuangan(i) { if (confirm('Hapus transaksi ini?')) { masjidData.keuangan.transaksi.splice(i, 1); saveData(); renderKeuangan(); } }
        
        // RENDER ZAKAT
        function renderZakat() {
            const zak = masjidData.zakat || {};
            const tr = zak.transaksi || [];
            const sa = zak.saldoAwal || 0;
            let tp = 0, tk = 0;
            tr.forEach(t => { if (t.jenis === 'pemasukan') tp += t.jumlah; else tk += t.jumlah; });
            const saldo = sa + tp - tk;
            document.getElementById('zakatStats').innerHTML = `<div class="stat-card"><div class="icon green"><i class="fas fa-arrow-down"></i></div><div class="info"><h4>Rp ${formatNumber(tp)}</h4><p>Zakat Masuk</p></div></div><div class="stat-card"><div class="icon red"><i class="fas fa-arrow-up"></i></div><div class="info"><h4>Rp ${formatNumber(tk)}</h4><p>Disalurkan</p></div></div><div class="stat-card"><div class="icon teal"><i class="fas fa-hand-holding-usd"></i></div><div class="info"><h4>Rp ${formatNumber(saldo)}</h4><p>Saldo Zakat</p></div></div>`;
            document.getElementById('saldoAwalZakat').value = sa;
            document.getElementById('zakatTable').innerHTML = tr.map((t, i) => `<tr><td data-label="Tanggal">${formatDate(t.tanggal)}</td><td data-label="Keterangan">${t.keterangan}</td><td data-label="Jenis"><span class="badge ${t.jenis === 'pemasukan' ? 'badge-success' : 'badge-danger'}">${t.jenis === 'pemasukan' ? 'Masuk' : 'Salur'}</span></td><td data-label="Jumlah">Rp ${formatNumber(t.jumlah)}</td><td><div class="action-btns"><button class="btn btn-warning btn-sm" onclick="editZakat(${i})"><i class="fas fa-edit"></i></button><button class="btn btn-danger btn-sm" onclick="deleteZakat(${i})"><i class="fas fa-trash"></i></button></div></td></tr>`).join('') || '<tr><td colspan="5">Belum ada transaksi zakat</td></tr>';
        }
        
        function saveSaldoAwalZakat() { if (!masjidData.zakat) masjidData.zakat = { saldoAwal: 0, transaksi: [] }; masjidData.zakat.saldoAwal = parseInt(document.getElementById('saldoAwalZakat').value) || 0; saveData(); renderZakat(); }
        
        function openZakatModal(i = null) {
            document.getElementById('modalZakatTitle').textContent = i !== null ? 'Edit Transaksi Zakat' : 'Tambah Transaksi Zakat';
            document.getElementById('zakatId').value = i !== null ? i : '';
            if (i !== null) { const t = masjidData.zakat.transaksi[i]; document.getElementById('zakatTanggal').value = t.tanggal; document.getElementById('zakatJenis').value = t.jenis; document.getElementById('zakatJumlah').value = t.jumlah; document.getElementById('zakatKeterangan').value = t.keterangan; }
            else { document.getElementById('zakatTanggal').value = new Date().toISOString().split('T')[0]; document.getElementById('zakatJenis').value = 'pemasukan'; document.getElementById('zakatJumlah').value = ''; document.getElementById('zakatKeterangan').value = ''; }
            document.getElementById('modalZakat').classList.add('active');
        }
        
        function editZakat(i) { openZakatModal(i); }
        
        function saveZakat() {
            const id = document.getElementById('zakatId').value;
            const data = { tanggal: document.getElementById('zakatTanggal').value, jenis: document.getElementById('zakatJenis').value, jumlah: parseInt(document.getElementById('zakatJumlah').value) || 0, keterangan: document.getElementById('zakatKeterangan').value };
            if (!data.jumlah) { showNotification('Jumlah wajib diisi!', 'error'); return; }
            if (!masjidData.zakat) masjidData.zakat = { saldoAwal: 0, transaksi: [] };
            if (!masjidData.zakat.transaksi) masjidData.zakat.transaksi = [];
            if (id !== '') masjidData.zakat.transaksi[parseInt(id)] = data; else masjidData.zakat.transaksi.unshift(data);
            closeModal('modalZakat'); saveData(); renderZakat();
        }
        
        function deleteZakat(i) { if (confirm('Hapus transaksi zakat ini?')) { masjidData.zakat.transaksi.splice(i, 1); saveData(); renderZakat(); } }
        
        // RENDER KISAH
        function renderKisah() {
            const t = document.getElementById('kisahTable');
            const k = masjidData.kisahInspiratif || [];
            t.innerHTML = k.map((x, i) => `<tr><td data-label="Gambar"><img src="${x.gambar || 'https://via.placeholder.com/45'}" style="border-radius:8px;width:50px;height:35px;object-fit:cover;"></td><td data-label="Judul">${x.judul}</td><td data-label="Isi">${truncate(x.isi, 30)}</td><td><div class="action-btns"><button class="btn btn-warning btn-sm" onclick="editKisah(${i})"><i class="fas fa-edit"></i></button><button class="btn btn-danger btn-sm" onclick="deleteKisah(${i})"><i class="fas fa-trash"></i></button></div></td></tr>`).join('') || '<tr><td colspan="4">Belum ada kisah</td></tr>';
        }
        
        function openKisahModal(i = null) {
            document.getElementById('modalKisahTitle').textContent = i !== null ? 'Edit Kisah' : 'Tambah Kisah';
            document.getElementById('kisahId').value = i !== null ? i : '';
            if (i !== null) { const k = masjidData.kisahInspiratif[i]; document.getElementById('kisahJudul').value = k.judul; document.getElementById('kisahGambar').value = k.gambar || ''; document.getElementById('kisahIsi').value = k.isi; }
            else { document.getElementById('kisahJudul').value = ''; document.getElementById('kisahGambar').value = ''; document.getElementById('kisahIsi').value = ''; }
            document.getElementById('modalKisah').classList.add('active');
        }
        
        function editKisah(i) { openKisahModal(i); }
        
        function saveKisah() {
            const id = document.getElementById('kisahId').value;
            const data = { judul: document.getElementById('kisahJudul').value, gambar: document.getElementById('kisahGambar').value, isi: document.getElementById('kisahIsi').value };
            if (!data.judul) { showNotification('Judul wajib diisi!', 'error'); return; }
            if (!masjidData.kisahInspiratif) masjidData.kisahInspiratif = [];
            if (id !== '') masjidData.kisahInspiratif[parseInt(id)] = data; else masjidData.kisahInspiratif.push(data);
            closeModal('modalKisah'); saveData(); renderKisah();
        }
        
        function deleteKisah(i) { if (confirm('Hapus kisah ini?')) { masjidData.kisahInspiratif.splice(i, 1); saveData(); renderKisah(); } }
        
        // RENDER DONASI
        function renderDonasi() {
            const t = document.getElementById('donasiTable');
            const d = masjidData.donasi || [];
            t.innerHTML = d.map((x, i) => `<tr><td data-label="Bank"><strong>${x.bank}</strong></td><td data-label="No. Rek">${x.noRekening}</td><td data-label="Atas Nama">${x.atasNama}</td><td><div class="action-btns"><button class="btn btn-warning btn-sm" onclick="editDonasi(${i})"><i class="fas fa-edit"></i></button><button class="btn btn-danger btn-sm" onclick="deleteDonasi(${i})"><i class="fas fa-trash"></i></button></div></td></tr>`).join('') || '<tr><td colspan="4">Belum ada data</td></tr>';
        }
        
        function openDonasiModal(i = null) {
            document.getElementById('modalDonasiTitle').textContent = i !== null ? 'Edit Rekening' : 'Tambah Rekening';
            document.getElementById('donasiId').value = i !== null ? i : '';
            if (i !== null) { const d = masjidData.donasi[i]; document.getElementById('donasiBank').value = d.bank; document.getElementById('donasiNoRek').value = d.noRekening; document.getElementById('donasiAtasNama').value = d.atasNama; }
            else { document.getElementById('donasiBank').value = ''; document.getElementById('donasiNoRek').value = ''; document.getElementById('donasiAtasNama').value = ''; }
            document.getElementById('modalDonasi').classList.add('active');
        }
        
        function editDonasi(i) { openDonasiModal(i); }
        
        function saveDonasi() {
            const id = document.getElementById('donasiId').value;
            const data = { bank: document.getElementById('donasiBank').value, noRekening: document.getElementById('donasiNoRek').value, atasNama: document.getElementById('donasiAtasNama').value };
            if (!data.bank) { showNotification('Nama bank wajib diisi!', 'error'); return; }
            if (!masjidData.donasi) masjidData.donasi = [];
            if (id !== '') masjidData.donasi[parseInt(id)] = data; else masjidData.donasi.push(data);
            closeModal('modalDonasi'); saveData(); renderDonasi();
        }
        
        function deleteDonasi(i) { if (confirm('Hapus rekening ini?')) { masjidData.donasi.splice(i, 1); saveData(); renderDonasi(); } }
        
        // RENDER GALERI
        function renderGaleri() {
            const t = document.getElementById('galeriTable');
            const g = masjidData.galeri || [];
            t.innerHTML = g.map((x, i) => {
                const preview = x.tipe === 'video' ? `<img src="https://img.youtube.com/vi/${x.youtubeId}/0.jpg" style="width:60px;height:35px;object-fit:cover;border-radius:5px;">` : `<img src="${x.url || 'https://via.placeholder.com/60x35'}" style="width:60px;height:35px;object-fit:cover;border-radius:5px;">`;
                return `<tr><td data-label="Preview">${preview}</td><td data-label="Tipe"><span class="badge ${x.tipe === 'video' ? 'badge-danger' : 'badge-info'}">${x.tipe}</span></td><td data-label="Caption">${x.caption || '-'}</td><td><div class="action-btns"><button class="btn btn-warning btn-sm" onclick="editGaleri(${i})"><i class="fas fa-edit"></i></button><button class="btn btn-danger btn-sm" onclick="deleteGaleri(${i})"><i class="fas fa-trash"></i></button></div></td></tr>`;
            }).join('') || '<tr><td colspan="4">Belum ada item</td></tr>';
        }
        
        // Toggle input berdasarkan tipe
function toggleGaleriInput() {
    var tipe = document.getElementById('galeriTipe').value;
    
    document.getElementById('galeriUrlGroup').style.display = 'none';
    document.getElementById('galeriYoutubeGroup').style.display = 'none';
    document.getElementById('galeriInstagramGroup').style.display = 'none';
    document.getElementById('galeriTiktokGroup').style.display = 'none';
    
    if (tipe === 'foto') {
        document.getElementById('galeriUrlGroup').style.display = 'block';
    } else if (tipe === 'youtube') {
        document.getElementById('galeriYoutubeGroup').style.display = 'block';
    } else if (tipe === 'instagram') {
        document.getElementById('galeriInstagramGroup').style.display = 'block';
    } else if (tipe === 'tiktok') {
        document.getElementById('galeriTiktokGroup').style.display = 'block';
    }
}

// Extract YouTube ID
function extractYoutubeId(url) {
    if (!url) return '';
    
    if (url.length === 11 && url.indexOf('/') === -1 && url.indexOf('.') === -1) {
        return url;
    }
    
    var videoId = '';
    
    if (url.indexOf('watch?v=') !== -1) {
        var parts = url.split('watch?v=');
        if (parts[1]) { videoId = parts[1].split('&')[0]; }
    } else if (url.indexOf('youtu.be/') !== -1) {
        var parts = url.split('youtu.be/');
        if (parts[1]) { videoId = parts[1].split('?')[0]; }
    } else if (url.indexOf('/embed/') !== -1) {
        var parts = url.split('/embed/');
        if (parts[1]) { videoId = parts[1].split('?')[0]; }
    } else if (url.indexOf('/shorts/') !== -1) {
        var parts = url.split('/shorts/');
        if (parts[1]) { videoId = parts[1].split('?')[0]; }
    } else if (url.indexOf('/live/') !== -1) {
        var parts = url.split('/live/');
        if (parts[1]) { videoId = parts[1].split('?')[0]; }
    }
    
    return videoId;
}

// Extract Instagram ID
function extractInstagramId(url) {
    if (!url) return '';
    
    var postId = '';
    
    // Format: instagram.com/p/POST_ID/ atau instagram.com/reel/REEL_ID/
    if (url.indexOf('/p/') !== -1) {
        var parts = url.split('/p/');
        if (parts[1]) { 
            postId = parts[1].split('/')[0].split('?')[0]; 
        }
    } else if (url.indexOf('/reel/') !== -1) {
        var parts = url.split('/reel/');
        if (parts[1]) { 
            postId = parts[1].split('/')[0].split('?')[0]; 
        }
    } else if (url.indexOf('/reels/') !== -1) {
        var parts = url.split('/reels/');
        if (parts[1]) { 
            postId = parts[1].split('/')[0].split('?')[0]; 
        }
    }
    
    return postId;
}

// Extract TikTok ID
function extractTiktokId(url) {
    if (!url) return '';
    
    var videoId = '';
    
    // Format: tiktok.com/@user/video/VIDEO_ID
    if (url.indexOf('/video/') !== -1) {
        var parts = url.split('/video/');
        if (parts[1]) { 
            videoId = parts[1].split('/')[0].split('?')[0]; 
        }
    }
    // Format: vm.tiktok.com/SHORT_CODE/
    else if (url.indexOf('vm.tiktok.com/') !== -1) {
        var parts = url.split('vm.tiktok.com/');
        if (parts[1]) { 
            videoId = 'vm_' + parts[1].split('/')[0].split('?')[0]; 
        }
    }
    // Format: tiktok.com/t/SHORT_CODE/
    else if (url.indexOf('/t/') !== -1) {
        var parts = url.split('/t/');
        if (parts[1]) { 
            videoId = 'vm_' + parts[1].split('/')[0].split('?')[0]; 
        }
    }
    
    return videoId;
}

// Open Modal Galeri
function openGaleriModal(i) {
    var titleEl = document.getElementById('modalGaleriTitle');
    var idEl = document.getElementById('galeriId');
    var tipeEl = document.getElementById('galeriTipe');
    var urlEl = document.getElementById('galeriUrl');
    var youtubeEl = document.getElementById('galeriYoutubeId');
    var instagramEl = document.getElementById('galeriInstagramId');
    var tiktokEl = document.getElementById('galeriTiktokId');
    var captionEl = document.getElementById('galeriCaption');
    
    if (i !== null && i !== undefined) {
        titleEl.textContent = 'Edit Media';
        idEl.value = i;
        
        var g = masjidData.galeri[i];
        var tipe = g.tipe ? g.tipe : 'foto';
        
        // Convert 'video' to 'youtube' for backward compatibility
        if (tipe === 'video') { tipe = 'youtube'; }
        
        tipeEl.value = tipe;
        urlEl.value = g.url ? g.url : '';
        youtubeEl.value = g.youtubeId ? g.youtubeId : '';
        instagramEl.value = g.instagramId ? g.instagramId : '';
        tiktokEl.value = g.tiktokId ? g.tiktokId : '';
        captionEl.value = g.caption ? g.caption : '';
    } else {
        titleEl.textContent = 'Tambah Media';
        idEl.value = '';
        tipeEl.value = 'foto';
        urlEl.value = '';
        youtubeEl.value = '';
        instagramEl.value = '';
        tiktokEl.value = '';
        captionEl.value = '';
    }
    
    toggleGaleriInput();
    document.getElementById('modalGaleri').classList.add('active');
}

function editGaleri(i) { 
    openGaleriModal(i); 
}

// Save Galeri
function saveGaleri() {
    var idEl = document.getElementById('galeriId');
    var tipeEl = document.getElementById('galeriTipe');
    var urlEl = document.getElementById('galeriUrl');
    var youtubeEl = document.getElementById('galeriYoutubeId');
    var instagramEl = document.getElementById('galeriInstagramId');
    var tiktokEl = document.getElementById('galeriTiktokId');
    var captionEl = document.getElementById('galeriCaption');
    
    var id = idEl ? idEl.value : '';
    var tipe = tipeEl ? tipeEl.value : 'foto';
    var caption = captionEl ? captionEl.value : '';
    
    var data = { tipe: tipe, caption: caption };
    
    if (tipe === 'foto') {
        var url = urlEl ? urlEl.value : '';
        if (!url) {
            showNotification('URL foto wajib diisi!', 'error');
            return;
        }
        data.url = url;
        
    } else if (tipe === 'youtube') {
        var youtubeInput = youtubeEl ? youtubeEl.value : '';
        var youtubeId = extractYoutubeId(youtubeInput);
        if (!youtubeId) {
            showNotification('Link YouTube tidak valid!', 'error');
            return;
        }
        data.youtubeId = youtubeId;
        
    } else if (tipe === 'instagram') {
        var instagramInput = instagramEl ? instagramEl.value : '';
        var instagramId = extractInstagramId(instagramInput);
        if (!instagramId) {
            showNotification('Link Instagram tidak valid!', 'error');
            return;
        }
        data.instagramId = instagramId;
        data.instagramUrl = instagramInput; // Simpan URL asli untuk embed
        
    } else if (tipe === 'tiktok') {
        var tiktokInput = tiktokEl ? tiktokEl.value : '';
        var tiktokId = extractTiktokId(tiktokInput);
        if (!tiktokId) {
            showNotification('Link TikTok tidak valid!', 'error');
            return;
        }
        data.tiktokId = tiktokId;
        data.tiktokUrl = tiktokInput; // Simpan URL asli untuk embed
    }
    
    if (!masjidData.galeri) { masjidData.galeri = []; }
    
    if (id !== '' && id !== null && id !== undefined) {
        masjidData.galeri[parseInt(id)] = data;
    } else {
        masjidData.galeri.push(data);
    }
    
    closeModal('modalGaleri');
    saveData();
    renderGaleri();
}

// Render Galeri Table di Admin
function renderGaleri() {
    var t = document.getElementById('galeriTable');
    if (!t) return;
    
    var g = masjidData.galeri;
    if (!g) { g = []; }
    
    var html = '';
    
    if (g.length === 0) {
        html = '<tr><td colspan="4">Belum ada item</td></tr>';
    } else {
        for (var i = 0; i < g.length; i++) {
            var x = g[i];
            var preview = '';
            var tipeLabel = '';
            var tipeClass = '';
            
            if (x.tipe === 'youtube' || x.tipe === 'video') {
                var ytId = x.youtubeId ? x.youtubeId : '';
                preview = '<img src="https://img.youtube.com/vi/' + ytId + '/0.jpg" style="width:60px;height:35px;object-fit:cover;border-radius:5px;">';
                tipeLabel = 'YouTube';
                tipeClass = 'badge-danger';
            } else if (x.tipe === 'instagram') {
                preview = '<div style="width:60px;height:35px;background:linear-gradient(45deg,#f09433,#e6683c,#dc2743,#cc2366,#bc1888);border-radius:5px;display:flex;align-items:center;justify-content:center;"><i class="fab fa-instagram" style="color:white;font-size:1.2rem;"></i></div>';
                tipeLabel = 'Instagram';
                tipeClass = 'badge-warning';
            } else if (x.tipe === 'tiktok') {
                preview = '<div style="width:60px;height:35px;background:#000;border-radius:5px;display:flex;align-items:center;justify-content:center;"><i class="fab fa-tiktok" style="color:white;font-size:1rem;"></i></div>';
                tipeLabel = 'TikTok';
                tipeClass = 'badge-dark';
            } else {
                var imgUrl = x.url ? x.url : 'https://via.placeholder.com/60x35';
                preview = '<img src="' + imgUrl + '" style="width:60px;height:35px;object-fit:cover;border-radius:5px;">';
                tipeLabel = 'Foto';
                tipeClass = 'badge-info';
            }
            
            var cap = x.caption ? x.caption : '-';
            
            html = html + '<tr>';
            html = html + '<td data-label="Preview">' + preview + '</td>';
            html = html + '<td data-label="Tipe"><span class="badge ' + tipeClass + '">' + tipeLabel + '</span></td>';
            html = html + '<td data-label="Caption">' + cap + '</td>';
            html = html + '<td><div class="action-btns"><button class="btn btn-warning btn-sm" onclick="editGaleri(' + i + ')"><i class="fas fa-edit"></i></button><button class="btn btn-danger btn-sm" onclick="deleteGaleri(' + i + ')"><i class="fas fa-trash"></i></button></div></td>';
            html = html + '</tr>';
        }
    }
    
    t.innerHTML = html;
}
        
        function deleteGaleri(i) { if (confirm('Hapus item ini?')) { masjidData.galeri.splice(i, 1); saveData(); renderGaleri(); } }
        
        // RENDER PENGUMUMAN
        function renderPengumuman() {
            const t = document.getElementById('pengumumanTable');
            const p = masjidData.pengumuman || [];
            t.innerHTML = p.map((x, i) => `<tr><td data-label="Tanggal">${formatDate(x.tanggal)}</td><td data-label="Judul">${x.judul}</td><td data-label="Status">${x.penting ? '<span class="badge badge-danger">PENTING</span>' : '<span class="badge badge-info">Normal</span>'}</td><td><div class="action-btns"><button class="btn btn-warning btn-sm" onclick="editPengumuman(${i})"><i class="fas fa-edit"></i></button><button class="btn btn-danger btn-sm" onclick="deletePengumuman(${i})"><i class="fas fa-trash"></i></button></div></td></tr>`).join('') || '<tr><td colspan="4">Belum ada pengumuman</td></tr>';
        }
        
        function openPengumumanModal(i = null) {
            document.getElementById('modalPengumumanTitle').textContent = i !== null ? 'Edit Pengumuman' : 'Tambah Pengumuman';
            document.getElementById('pengumumanId').value = i !== null ? i : '';
            if (i !== null) { const p = masjidData.pengumuman[i]; document.getElementById('pengumumanTanggal').value = p.tanggal; document.getElementById('pengumumanJudul').value = p.judul; document.getElementById('pengumumanIsi').value = p.isi; document.getElementById('pengumumanPenting').checked = p.penting; }
            else { document.getElementById('pengumumanTanggal').value = new Date().toISOString().split('T')[0]; document.getElementById('pengumumanJudul').value = ''; document.getElementById('pengumumanIsi').value = ''; document.getElementById('pengumumanPenting').checked = false; }
            document.getElementById('modalPengumuman').classList.add('active');
        }
        
        function editPengumuman(i) { openPengumumanModal(i); }
        
        function savePengumuman() {
            const id = document.getElementById('pengumumanId').value;
            const data = { tanggal: document.getElementById('pengumumanTanggal').value, judul: document.getElementById('pengumumanJudul').value, isi: document.getElementById('pengumumanIsi').value, penting: document.getElementById('pengumumanPenting').checked };
            if (!data.judul) { showNotification('Judul wajib diisi!', 'error'); return; }
            if (!masjidData.pengumuman) masjidData.pengumuman = [];
            if (id !== '') masjidData.pengumuman[parseInt(id)] = data; else masjidData.pengumuman.unshift(data);
            closeModal('modalPengumuman'); saveData(); renderPengumuman();
        }
        
        function deletePengumuman(i) { if (confirm('Hapus pengumuman ini?')) { masjidData.pengumuman.splice(i, 1); saveData(); renderPengumuman(); } }
    </script>
</body>
</html>