<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Masjid Mekarindah</title>
    <link rel="icon" type="image/x-icon" href="https://cdn-icons-png.flaticon.com/512/5765/5765953.png">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #0d7a3a;
            --primary-dark: #095c2b;
            --primary-light: #e8f5e9;
            --gold: #d4af37;
            --gold-light: #f5e6b3;
            --dark: #1a1a2e;
            --gray: #6c757d;
            --light: #f8f9fa;
            --white: #ffffff;
            --danger: #dc3545;
            --warning: #ffc107;
            --info: #17a2b8;
            --success: #28a745;
            --shadow: 0 4px 15px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 30px rgba(0,0,0,0.15);
            --radius: 12px;
            --transition: all 0.3s ease;
            --sidebar-width: 280px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--light);
            color: var(--dark);
            line-height: 1.6;
        }

        /* ==================== LOGIN PAGE ==================== */
        .login-page {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            padding: 20px;
        }

        .login-box {
            background: var(--white);
            padding: 50px 40px;
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            width: 100%;
            max-width: 420px;
            text-align: center;
        }

        .login-box .logo {
            margin-bottom: 30px;
        }

        .login-box .logo i {
            font-size: 4rem;
            color: var(--primary);
        }

        .login-box h1 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 1.8rem;
        }

        .login-box p {
            color: var(--gray);
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
            transition: var(--transition);
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(13, 122, 58, 0.1);
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: var(--white);
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--success);
            color: var(--white);
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-danger {
            background: var(--danger);
            color: var(--white);
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-warning {
            background: var(--warning);
            color: var(--dark);
        }

        .btn-secondary {
            background: var(--gray);
            color: var(--white);
        }

        .btn-sm {
            padding: 8px 15px;
            font-size: 0.85rem;
        }

        .btn-block {
            width: 100%;
        }

        .login-error {
            background: #ffe6e6;
            color: var(--danger);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        /* ==================== ADMIN LAYOUT ==================== */
        .admin-container {
            display: none;
        }

        .admin-container.active {
            display: flex;
        }

        /* ==================== SIDEBAR ==================== */
        .sidebar {
            width: var(--sidebar-width);
            background: linear-gradient(180deg, var(--dark) 0%, #0f0f1a 100%);
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            overflow-y: auto;
            z-index: 1000;
            transition: var(--transition);
        }

        .sidebar-header {
            padding: 25px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .sidebar-header i {
            font-size: 2rem;
            color: var(--gold);
        }

        .sidebar-header h2 {
            color: var(--white);
            font-size: 1.1rem;
        }

        .sidebar-header span {
            color: rgba(255,255,255,0.6);
            font-size: 0.75rem;
            display: block;
        }

        .sidebar-menu {
            padding: 20px 0;
        }

        .menu-category {
            padding: 10px 20px;
            color: rgba(255,255,255,0.4);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            transition: var(--transition);
            cursor: pointer;
            border-left: 3px solid transparent;
        }

        .menu-item:hover {
            background: rgba(255,255,255,0.05);
            color: var(--white);
        }

        .menu-item.active {
            background: rgba(13, 122, 58, 0.2);
            color: var(--gold);
            border-left-color: var(--gold);
        }

        .menu-item i {
            width: 20px;
            text-align: center;
        }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
            margin-top: auto;
        }

        .sidebar-footer .btn {
            width: 100%;
        }

        /* ==================== MAIN CONTENT ==================== */
        .main-content {
            margin-left: var(--sidebar-width);
            flex: 1;
            min-height: 100vh;
        }

        .top-bar {
            background: var(--white);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .top-bar h1 {
            font-size: 1.5rem;
            color: var(--dark);
        }

        .top-bar-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .hamburger-admin {
            display: none;
            flex-direction: column;
            gap: 5px;
            cursor: pointer;
            padding: 10px;
        }

        .hamburger-admin span {
            width: 25px;
            height: 3px;
            background: var(--dark);
            border-radius: 3px;
        }

        .content-area {
            padding: 30px;
        }

        /* ==================== CARDS ==================== */
        .card {
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            margin-bottom: 25px;
            overflow: hidden;
        }

        .card-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: var(--white);
            padding: 20px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-header h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.2rem;
        }

        .card-header h3 i {
            color: var(--gold);
        }

        .card-body {
            padding: 25px;
        }

        /* ==================== DASHBOARD STATS ==================== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--white);
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 20px;
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--white);
        }

        .stat-icon.green { background: linear-gradient(135deg, #11998e, #38ef7d); }
        .stat-icon.blue { background: linear-gradient(135deg, #667eea, #764ba2); }
        .stat-icon.orange { background: linear-gradient(135deg, #f093fb, #f5576c); }
        .stat-icon.gold { background: linear-gradient(135deg, var(--gold), #f0c14b); }

        .stat-info h4 {
            font-size: 1.8rem;
            color: var(--dark);
            margin-bottom: 5px;
        }

        .stat-info p {
            color: var(--gray);
            font-size: 0.9rem;
        }

        /* ==================== PAGE SECTIONS ==================== */
        .page-section {
            display: none;
        }

        .page-section.active {
            display: block;
        }

        /* ==================== TABLE ==================== */
        .table-responsive {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        table th,
        table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        table th {
            background: var(--light);
            font-weight: 600;
            color: var(--dark);
        }

        table tr:hover {
            background: var(--primary-light);
        }

        table img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 8px;
        }

        .actions {
            display: flex;
            gap: 8px;
        }

        .actions .btn {
            padding: 6px 12px;
            font-size: 0.8rem;
        }

        /* ==================== MODAL ==================== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.6);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--white);
            border-radius: var(--radius);
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlide 0.3s ease;
        }

        .modal-content.large {
            max-width: 800px;
        }

        @keyframes modalSlide {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: var(--white);
            padding: 20px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .modal-header h3 i {
            color: var(--gold);
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--white);
            font-size: 1.5rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .modal-close:hover {
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 25px;
        }

        .modal-footer {
            padding: 15px 25px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* ==================== RINCIAN INPUT ==================== */
        .rincian-group {
            background: var(--light);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .rincian-group h5 {
            color: var(--primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .rincian-group h5 i {
            color: var(--gold);
        }

        .rincian-list {
            margin-bottom: 15px;
        }

        .rincian-item {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        .rincian-item input {
            flex: 1;
            padding: 10px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-family: inherit;
        }

        .rincian-item input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .rincian-item .input-keterangan {
            flex: 2;
        }

        .rincian-item .input-nominal {
            flex: 1;
        }

        .rincian-item .btn-remove {
            background: var(--danger);
            color: var(--white);
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .rincian-item .btn-remove:hover {
            background: #c82333;
        }

        .btn-add-rincian {
            background: var(--primary-light);
            color: var(--primary);
            border: 2px dashed var(--primary);
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            font-weight: 500;
            transition: var(--transition);
        }

        .btn-add-rincian:hover {
            background: var(--primary);
            color: var(--white);
        }

        .total-display {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: var(--white);
            padding: 15px 20px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
        }

        .total-display.masuk {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .total-display.keluar {
            background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
        }

        .total-display .label {
            font-weight: 500;
        }

        .total-display .value {
            font-size: 1.3rem;
            font-weight: 700;
        }

        /* ==================== MISI LIST INPUT ==================== */
        .misi-input-list {
            margin-bottom: 15px;
        }

        .misi-input-item {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .misi-input-item input {
            flex: 1;
            padding: 10px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-family: inherit;
        }

        .misi-input-item input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .misi-input-item .btn-remove {
            background: var(--danger);
            color: var(--white);
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        /* ==================== CHECKBOX ==================== */
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        /* ==================== TOAST ==================== */
        .toast {
            position: fixed;
            top: 30px;
            right: 30px;
            background: var(--success);
            color: var(--white);
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: var(--shadow-lg);
            z-index: 3000;
            transform: translateX(150%);
            transition: transform 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 400px;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.error {
            background: var(--danger);
        }

        /* ==================== LOADING ==================== */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.9);
            z-index: 5000;
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 20px;
        }

        .loading-overlay.show {
            display: flex;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--primary-light);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ==================== EMPTY STATE ==================== */
        .empty-state {
            text-align: center;
            padding: 50px 20px;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 4rem;
            color: #ddd;
            margin-bottom: 20px;
        }

        .empty-state h4 {
            margin-bottom: 10px;
            color: var(--dark);
        }

        /* ==================== RESPONSIVE ==================== */
        @media (max-width: 992px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .hamburger-admin {
                display: flex;
            }

            .sidebar-overlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.5);
                z-index: 999;
            }

            .sidebar-overlay.active {
                display: block;
            }
        }

        @media (max-width: 768px) {
            .content-area {
                padding: 20px 15px;
            }

            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }

            .rincian-item {
                flex-wrap: wrap;
            }

            .rincian-item .input-keterangan {
                flex: 1 1 100%;
            }

            .rincian-item .input-nominal {
                flex: 1 1 calc(100% - 46px);
            }

            table th, table td {
                padding: 10px 8px;
                font-size: 0.85rem;
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .stat-card {
                padding: 20px;
            }

            .modal-content {
                margin: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- LOGIN PAGE -->
    <div class="login-page" id="loginPage">
        <div class="login-box">
            <div class="logo">
                <i class="fas fa-mosque"></i>
            </div>
            <h1>Admin Panel</h1>
            <p>Masjid Jami' Mekarindah</p>
            
            <div class="login-error" id="loginError">
                Username atau password salah!
            </div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label><i class="fas fa-user"></i> Username</label>
                    <input type="text" id="username" placeholder="Masukkan username" required>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-lock"></i> Password</label>
                    <input type="password" id="password" placeholder="Masukkan password" required>
                </div>
                <button type="submit" class="btn btn-primary btn-block">
                    <i class="fas fa-sign-in-alt"></i> Masuk
                </button>
            </form>
        </div>
    </div>

    <!-- ADMIN CONTAINER -->
    <div class="admin-container" id="adminContainer">
        <!-- Sidebar Overlay -->
        <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>
        
        <!-- SIDEBAR -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <i class="fas fa-mosque"></i>
                <div>
                    <h2>Admin Panel</h2>
                    <span>Masjid Mekarindah</span>
                </div>
            </div>
            
            <nav class="sidebar-menu">
                <div class="menu-category">Menu Utama</div>
                <a class="menu-item active" data-page="dashboard">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
                
                <div class="menu-category">Konten</div>
                <a class="menu-item" data-page="tentang">
                    <i class="fas fa-info-circle"></i>
                    <span>Tentang Masjid</span>
                </a>
                <a class="menu-item" data-page="pengurus">
                    <i class="fas fa-users"></i>
                    <span>Pengurus</span>
                </a>
                <a class="menu-item" data-page="kajian">
                    <i class="fas fa-book-open"></i>
                    <span>Jadwal Kajian</span>
                </a>
                
                <div class="menu-category">Keuangan</div>
                <a class="menu-item" data-page="keuangan">
                    <i class="fas fa-wallet"></i>
                    <span>Laporan Keuangan</span>
                </a>
                <a class="menu-item" data-page="zakat">
                    <i class="fas fa-hand-holding-heart"></i>
                    <span>Laporan Zakat</span>
                </a>
                
                <div class="menu-category">Media</div>
                <a class="menu-item" data-page="kisah">
                    <i class="fas fa-star"></i>
                    <span>Kisah Inspiratif</span>
                </a>
                <a class="menu-item" data-page="galeri">
                    <i class="fas fa-images"></i>
                    <span>Galeri</span>
                </a>
                <a class="menu-item" data-page="serbi">
                    <i class="fas fa-newspaper"></i>
                    <span>Serba Serbi</span>
                </a>
                
                <div class="menu-category">Sistem</div>
                <a class="menu-item" data-page="pengaturan">
                    <i class="fas fa-cog"></i>
                    <span>Pengaturan</span>
                </a>
            </nav>
            
            <div class="sidebar-footer">
                <button class="btn btn-danger btn-block" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Keluar
                </button>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="main-content">
            <div class="top-bar">
                <div class="hamburger-admin" onclick="toggleSidebar()">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <h1 id="pageTitle">Dashboard</h1>
                <div class="top-bar-actions">
                    <a href="index.html" target="_blank" class="btn btn-primary btn-sm">
                        <i class="fas fa-external-link-alt"></i> Lihat Website
                    </a>
                </div>
            </div>

            <div class="content-area">
                <!-- DASHBOARD -->
                <div class="page-section active" id="page-dashboard">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon green">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-info">
                                <h4 id="statPengurus">0</h4>
                                <p>Total Pengurus</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon blue">
                                <i class="fas fa-book-open"></i>
                            </div>
                            <div class="stat-info">
                                <h4 id="statKajian">0</h4>
                                <p>Jadwal Kajian</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon orange">
                                <i class="fas fa-images"></i>
                            </div>
                            <div class="stat-info">
                                <h4 id="statGaleri">0</h4>
                                <p>Item Galeri</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon gold">
                                <i class="fas fa-newspaper"></i>
                            </div>
                            <div class="stat-info">
                                <h4 id="statSerbi">0</h4>
                                <p>Serba Serbi</p>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-info-circle"></i> Panduan Admin</h3>
                        </div>
                        <div class="card-body">
                            <p>Selamat datang di Admin Panel Masjid Mekarindah. Gunakan menu di samping untuk mengelola konten website:</p>
                            <ul style="margin-top: 15px; margin-left: 20px;">
                                <li><strong>Tentang Masjid</strong> - Edit deskripsi, visi, dan misi masjid</li>
                                <li><strong>Pengurus</strong> - Kelola data pengurus (Yayasan, DKM, Majlis Ta'lim)</li>
                                <li><strong>Jadwal Kajian</strong> - Atur jadwal kajian rutin</li>
                                <li><strong>Laporan Keuangan</strong> - Input laporan keuangan bulanan</li>
                                <li><strong>Laporan Zakat</strong> - Input laporan zakat tahunan</li>
                                <li><strong>Kisah Inspiratif</strong> - Tambah kisah dan hikmah</li>
                                <li><strong>Galeri</strong> - Upload foto, video YouTube, Instagram, TikTok</li>
                                <li><strong>Serba Serbi</strong> - Posting informasi dan berita</li>
                                <li><strong>Pengaturan</strong> - Atur gambar masjid, peta, alamat, rekening</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- TENTANG -->
                <div class="page-section" id="page-tentang">
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-info-circle"></i> Tentang Masjid</h3>
                        </div>
                        <div class="card-body">
                            <form id="formTentang">
                                <div class="form-group">
                                    <label>Deskripsi Masjid</label>
                                    <textarea id="tentangDeskripsi" rows="4" placeholder="Tuliskan deskripsi masjid..."></textarea>
                                </div>
                                <div class="form-group">
                                    <label>Visi</label>
                                    <textarea id="tentangVisi" rows="3" placeholder="Tuliskan visi masjid..."></textarea>
                                </div>
                                <div class="form-group">
                                    <label>Misi</label>
                                    <div class="misi-input-list" id="misiList"></div>
                                    <button type="button" class="btn-add-rincian" onclick="addMisiItem()">
                                        <i class="fas fa-plus"></i> Tambah Misi
                                    </button>
                                </div>
                                <button type="submit" class="btn btn-success">
                                    <i class="fas fa-save"></i> Simpan Perubahan
                                </button>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- PENGURUS -->
                <div class="page-section" id="page-pengurus">
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-users"></i> Kelola Pengurus</h3>
                            <button class="btn btn-success btn-sm" onclick="openPengurusModal()">
                                <i class="fas fa-plus"></i> Tambah Pengurus
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Foto</th>
                                            <th>Nama</th>
                                            <th>Jabatan</th>
                                            <th>Kategori</th>
                                            <th>Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody id="pengurusTable"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- KAJIAN -->
                <div class="page-section" id="page-kajian">
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-book-open"></i> Jadwal Kajian</h3>
                            <button class="btn btn-success btn-sm" onclick="openKajianModal()">
                                <i class="fas fa-plus"></i> Tambah Kajian
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Hari</th>
                                            <th>Waktu</th>
                                            <th>Tema</th>
                                            <th>Ustadz</th>
                                            <th>Link</th>
                                            <th>Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody id="kajianTable"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- KEUANGAN -->
                <div class="page-section" id="page-keuangan">
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-wallet"></i> Laporan Keuangan</h3>
                            <button class="btn btn-success btn-sm" onclick="openKeuanganModal()">
                                <i class="fas fa-plus"></i> Tambah Periode
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Periode</th>
                                            <th>Saldo Awal</th>
                                            <th>Pemasukan</th>
                                            <th>Pengeluaran</th>
                                            <th>Saldo Akhir</th>
                                            <th>Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody id="keuanganTable"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ZAKAT -->
                <div class="page-section" id="page-zakat">
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-hand-holding-heart"></i> Laporan Zakat</h3>
                            <button class="btn btn-success btn-sm" onclick="openZakatModal()">
                                <i class="fas fa-plus"></i> Tambah Tahun
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Tahun</th>
                                            <th>Saldo Awal</th>
                                            <th>Penerimaan</th>
                                            <th>Penyaluran</th>
                                            <th>Saldo Akhir</th>
                                            <th>Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody id="zakatTable"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- KISAH -->
                <div class="page-section" id="page-kisah">
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-star"></i> Kisah Inspiratif</h3>
                            <button class="btn btn-success btn-sm" onclick="openKisahModal()">
                                <i class="fas fa-plus"></i> Tambah Kisah
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Gambar</th>
                                            <th>Judul</th>
                                            <th>Tanggal</th>
                                            <th>Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody id="kisahTable"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- GALERI -->
                <div class="page-section" id="page-galeri">
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-images"></i> Galeri</h3>
                            <button class="btn btn-success btn-sm" onclick="openGaleriModal()">
                                <i class="fas fa-plus"></i> Tambah Media
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Preview</th>
                                            <th>Tipe</th>
                                            <th>Keterangan</th>
                                            <th>Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody id="galeriTable"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SERBA SERBI -->
                <div class="page-section" id="page-serbi">
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-newspaper"></i> Serba Serbi</h3>
                            <button class="btn btn-success btn-sm" onclick="openSerbiModal()">
                                <i class="fas fa-plus"></i> Tambah Info
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Gambar</th>
                                            <th>Judul</th>
                                            <th>Tanggal</th>
                                            <th>Penting</th>
                                            <th>Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody id="serbiTable"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PENGATURAN -->
                <div class="page-section" id="page-pengaturan">
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-cog"></i> Pengaturan Website</h3>
                        </div>
                        <div class="card-body">
                            <form id="formPengaturan">
                                <div class="form-group">
                                    <label>URL Gambar Masjid (Hero)</label>
                                    <input type="url" id="pengaturanGambar" placeholder="https://example.com/gambar-masjid.jpg">
                                    <small style="color: var(--gray);">Ukuran ideal: 400x400 px (Akan ditampilkan bulat)</small>
                                </div>
                                <div class="form-group">
                                    <label>Embed Map Google</label>
                                    <textarea id="pengaturanMap" rows="4" placeholder="<iframe src='...'></iframe>"></textarea>
                                    <small style="color: var(--gray);">Paste kode embed dari Google Maps</small>
                                </div>
                                <div class="form-group">
                                    <label>Alamat Lengkap</label>
                                    <textarea id="pengaturanAlamat" rows="2" placeholder="Jalan ..."></textarea>
                                </div>
                                <div class="form-group">
                                    <label>Nama Bank</label>
                                    <input type="text" id="pengaturanBank" placeholder="BSI">
                                </div>
                                <div class="form-group">
                                    <label>Nomor Rekening</label>
                                    <input type="text" id="pengaturanRekening" placeholder="1234-5678-9012">
                                </div>
                                <div class="form-group">
                                    <label>Atas Nama</label>
                                    <input type="text" id="pengaturanAtasNama" placeholder="Yayasan Islam Mekarindah">
                                </div>
                                <button type="submit" class="btn btn-success">
                                    <i class="fas fa-save"></i> Simpan Pengaturan
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- MODAL PENGURUS -->
    <div class="modal" id="modalPengurus">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-plus"></i> <span id="modalPengurusTitle">Tambah Pengurus</span></h3>
                <button class="modal-close" onclick="closeModal('modalPengurus')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="formPengurus">
                    <input type="hidden" id="pengurusIndex" value="-1">
                    <div class="form-group">
                        <label>Nama Lengkap</label>
                        <input type="text" id="pengurusNama" required>
                    </div>
                    <div class="form-group">
                        <label>Jabatan</label>
                        <input type="text" id="pengurusJabatan" required>
                    </div>
                    <div class="form-group">
                        <label>Kategori</label>
                        <select id="pengurusKategori" required>
                            <option value="yayasan">Yayasan</option>
                            <option value="dkm">DKM</option>
                            <option value="majlistaklim">Majlis Ta'lim</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>URL Foto</label>
                        <input type="url" id="pengurusFoto" placeholder="https://...">
                        <small style="color: var(--gray);">Ukuran ideal: 400x400 px (1:1)</small>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('modalPengurus')">Batal</button>
                <button class="btn btn-success" onclick="savePengurus()">
                    <i class="fas fa-save"></i> Simpan
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL KAJIAN -->
    <div class="modal" id="modalKajian">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-book-open"></i> <span id="modalKajianTitle">Tambah Kajian</span></h3>
                <button class="modal-close" onclick="closeModal('modalKajian')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="formKajian">
                    <input type="hidden" id="kajianIndex" value="-1">
                    <div class="form-group">
                        <label>Hari</label>
                        <select id="kajianHari" required>
                            <option value="Senin">Senin</option>
                            <option value="Selasa">Selasa</option>
                            <option value="Rabu">Rabu</option>
                            <option value="Kamis">Kamis</option>
                            <option value="Jumat">Jumat</option>
                            <option value="Sabtu">Sabtu</option>
                            <option value="Ahad">Ahad</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Waktu</label>
                        <input type="text" id="kajianWaktu" placeholder="Ba'da Maghrib" required>
                    </div>
                    <div class="form-group">
                        <label>Tema Kajian</label>
                        <input type="text" id="kajianTema" required>
                    </div>
                    <div class="form-group">
                        <label>Nama Ustadz</label>
                        <input type="text" id="kajianUstadz" required>
                    </div>
                    <div class="form-group">
                        <label>Link Video/Audio (Opsional)</label>
                        <input type="url" id="kajianLink" placeholder="https://youtube.com/...">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('modalKajian')">Batal</button>
                <button class="btn btn-success" onclick="saveKajian()">
                    <i class="fas fa-save"></i> Simpan
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL KEUANGAN -->
    <div class="modal" id="modalKeuangan">
        <div class="modal-content large">
            <div class="modal-header">
                <h3><i class="fas fa-wallet"></i> <span id="modalKeuanganTitle">Tambah Laporan Keuangan</span></h3>
                <button class="modal-close" onclick="closeModal('modalKeuangan')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="formKeuangan">
                    <input type="hidden" id="keuanganIndex" value="-1">
                    <div class="form-group">
                        <label>Periode (Bulan Tahun)</label>
                        <input type="text" id="keuanganPeriode" placeholder="Januari 2025" required>
                    </div>
                    <div class="form-group">
                        <label>Saldo Awal</label>
                        <input type="number" id="keuanganSaldoAwal" value="0" required>
                    </div>
                    
                    <!-- Rincian Pemasukan -->
                    <div class="rincian-group">
                        <h5><i class="fas fa-arrow-down"></i> Rincian Pemasukan</h5>
                        <div class="rincian-list" id="keuanganRincianMasuk"></div>
                        <button type="button" class="btn-add-rincian" onclick="addRincianItem('keuanganRincianMasuk')">
                            <i class="fas fa-plus"></i> Tambah Item Pemasukan
                        </button>
                        <div class="total-display masuk">
                            <span class="label">Total Pemasukan:</span>
                            <span class="value" id="keuanganTotalMasuk">Rp 0</span>
                        </div>
                    </div>

                    <!-- Rincian Pengeluaran -->
                    <div class="rincian-group">
                        <h5><i class="fas fa-arrow-up"></i> Rincian Pengeluaran</h5>
                        <div class="rincian-list" id="keuanganRincianKeluar"></div>
                        <button type="button" class="btn-add-rincian" onclick="addRincianItem('keuanganRincianKeluar')">
                            <i class="fas fa-plus"></i> Tambah Item Pengeluaran
                        </button>
                        <div class="total-display keluar">
                            <span class="label">Total Pengeluaran:</span>
                            <span class="value" id="keuanganTotalKeluar">Rp 0</span>
                        </div>
                    </div>

                    <!-- Saldo Akhir -->
                    <div class="total-display" style="background: linear-gradient(135deg, var(--gold), #f0c14b); color: var(--dark);">
                        <span class="label"><strong>Saldo Akhir:</strong></span>
                        <span class="value" id="keuanganSaldoAkhir">Rp 0</span>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('modalKeuangan')">Batal</button>
                <button class="btn btn-success" onclick="saveKeuangan()">
                    <i class="fas fa-save"></i> Simpan
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL ZAKAT -->
    <div class="modal" id="modalZakat">
        <div class="modal-content large">
            <div class="modal-header">
                <h3><i class="fas fa-hand-holding-heart"></i> <span id="modalZakatTitle">Tambah Laporan Zakat</span></h3>
                <button class="modal-close" onclick="closeModal('modalZakat')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="formZakat">
                    <input type="hidden" id="zakatIndex" value="-1">
                    <div class="form-group">
                        <label>Tahun (Hijriah / Masehi)</label>
                        <input type="text" id="zakatTahun" placeholder="1446 H / 2025 M" required>
                    </div>
                    <div class="form-group">
                        <label>Saldo Awal</label>
                        <input type="number" id="zakatSaldoAwal" value="0" required>
                    </div>
                    
                    <!-- Rincian Penerimaan -->
                    <div class="rincian-group">
                        <h5><i class="fas fa-arrow-down"></i> Rincian Penerimaan Zakat</h5>
                        <div class="rincian-list" id="zakatRincianMasuk"></div>
                        <button type="button" class="btn-add-rincian" onclick="addRincianItem('zakatRincianMasuk')">
                            <i class="fas fa-plus"></i> Tambah Item Penerimaan
                        </button>
                        <div class="total-display masuk">
                            <span class="label">Total Penerimaan:</span>
                            <span class="value" id="zakatTotalMasuk">Rp 0</span>
                        </div>
                    </div>

                    <!-- Rincian Penyaluran -->
                    <div class="rincian-group">
                        <h5><i class="fas fa-arrow-up"></i> Rincian Penyaluran Zakat</h5>
                        <div class="rincian-list" id="zakatRincianKeluar"></div>
                        <button type="button" class="btn-add-rincian" onclick="addRincianItem('zakatRincianKeluar')">
                            <i class="fas fa-plus"></i> Tambah Item Penyaluran
                        </button>
                        <div class="total-display keluar">
                            <span class="label">Total Penyaluran:</span>
                            <span class="value" id="zakatTotalKeluar">Rp 0</span>
                        </div>
                    </div>

                    <!-- Saldo Akhir -->
                    <div class="total-display" style="background: linear-gradient(135deg, var(--gold), #f0c14b); color: var(--dark);">
                        <span class="label"><strong>Saldo Akhir:</strong></span>
                        <span class="value" id="zakatSaldoAkhir">Rp 0</span>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('modalZakat')">Batal</button>
                <button class="btn btn-success" onclick="saveZakat()">
                    <i class="fas fa-save"></i> Simpan
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL KISAH -->
    <div class="modal" id="modalKisah">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-star"></i> <span id="modalKisahTitle">Tambah Kisah</span></h3>
                <button class="modal-close" onclick="closeModal('modalKisah')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="formKisah">
                    <input type="hidden" id="kisahIndex" value="-1">
                    <div class="form-group">
                        <label>Judul</label>
                        <input type="text" id="kisahJudul" required>
                    </div>
                    <div class="form-group">
                        <label>Tanggal</label>
                        <input type="date" id="kisahTanggal" required>
                    </div>
                    <div class="form-group">
                        <label>URL Gambar</label>
                        <input type="url" id="kisahGambar" placeholder="https://...">
                        <small style="color: var(--gray);">Ukuran ideal: 800x500 px (8:5)</small>
                    </div>
                    <div class="form-group">
                        <label>Isi Kisah</label>
                        <textarea id="kisahIsi" rows="6" required></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('modalKisah')">Batal</button>
                <button class="btn btn-success" onclick="saveKisah()">
                    <i class="fas fa-save"></i> Simpan
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL GALERI -->
    <div class="modal" id="modalGaleri">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-images"></i> <span id="modalGaleriTitle">Tambah Media</span></h3>
                <button class="modal-close" onclick="closeModal('modalGaleri')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="formGaleri">
                    <input type="hidden" id="galeriIndex" value="-1">
                    <div class="form-group">
                        <label>Tipe Media</label>
                        <select id="galeriTipe" required>
                            <option value="foto">Foto</option>
                            <option value="youtube">YouTube</option>
                            <option value="instagram">Instagram</option>
                            <option value="tiktok">TikTok</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>URL</label>
                        <input type="url" id="galeriUrl" required placeholder="https://...">
                        <small style="color: var(--gray);">
                            Foto: Link gambar langsung<br>
                            YouTube: Link video YouTube<br>
                            Instagram: Link post Instagram<br>
                            TikTok: Link video TikTok
                        </small>
                    </div>
                    <div class="form-group">
                        <label>Keterangan</label>
                        <input type="text" id="galeriKeterangan" placeholder="Deskripsi singkat...">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('modalGaleri')">Batal</button>
                <button class="btn btn-success" onclick="saveGaleri()">
                    <i class="fas fa-save"></i> Simpan
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL SERBA SERBI -->
    <div class="modal" id="modalSerbi">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-newspaper"></i> <span id="modalSerbiTitle">Tambah Info</span></h3>
                <button class="modal-close" onclick="closeModal('modalSerbi')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="formSerbi">
                    <input type="hidden" id="serbiIndex" value="-1">
                    <div class="form-group">
                        <label>Judul</label>
                        <input type="text" id="serbiJudul" required>
                    </div>
                    <div class="form-group">
                        <label>Tanggal</label>
                        <input type="date" id="serbiTanggal" required>
                    </div>
                    <div class="form-group">
                        <label>URL Gambar</label>
                        <input type="url" id="serbiGambar" placeholder="https://...">
                        <small style="color: var(--gray);">Ukuran ideal: 800x500 px (8:5)</small>
                    </div>
                    <div class="form-group">
                        <label>Isi</label>
                        <textarea id="serbiIsi" rows="6" required></textarea>
                    </div>
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="serbiPenting">
                            <label for="serbiPenting">Tandai sebagai PENTING</label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('modalSerbi')">Batal</button>
                <button class="btn btn-success" onclick="saveSerbi()">
                    <i class="fas fa-save"></i> Simpan
                </button>
            </div>
        </div>
    </div>

    <!-- TOAST -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toastMessage">Berhasil!</span>
    </div>

    <!-- LOADING -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <p>Menyimpan data...</p>
    </div>

    <script>
        // ==================== CONFIG ====================
        const CONFIG = {
            BIN_ID: '696382b6d0ea881f4063d4d7',
            API_KEY: '$2a$10$amElu/7hqB7QAfAipp.qtOYQd1BhrP82EfsNbB4jS.0EKexF6Z/t.',
            USERNAME: 'admin',
            PASSWORD: 'mekarindah2025'
        };

        let siteData = {
            tentang: { deskripsi: '', visi: '', misi: [] },
            pengurus: [],
            kajian: [],
            keuangan: [],
            zakat: [],
            kisah: [],
            galeri: [],
            serbaSerbi: [],
            pengaturan: {
                gambarMasjid: '',
                mapEmbed: '',
                alamat: '',
                bank: '',
                rekening: '',
                atasNama: ''
            }
        };

        // ==================== INIT ====================
        document.addEventListener('DOMContentLoaded', () => {
            checkAuth();
            initMenus();
            initForms();
        });

        // ==================== AUTH ====================
        function checkAuth() {
            const isLoggedIn = sessionStorage.getItem('adminLoggedIn');
            if (isLoggedIn === 'true') {
                showAdmin();
            }
        }

        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            if (username === CONFIG.USERNAME && password === CONFIG.PASSWORD) {
                sessionStorage.setItem('adminLoggedIn', 'true');
                showAdmin();
            } else {
                document.getElementById('loginError').style.display = 'block';
            }
        });

        function showAdmin() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('adminContainer').classList.add('active');
            loadData();
        }

        function logout() {
            sessionStorage.removeItem('adminLoggedIn');
            location.reload();
        }

        // ==================== DATA OPERATIONS ====================
        async function loadData() {
            showLoading();
            try {
                const response = await fetch(`https://api.jsonbin.io/v3/b/${CONFIG.BIN_ID}/latest`, {
                    headers: { 
                        'X-Master-Key': CONFIG.API_KEY 
                    }
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }
                
                const result = await response.json();
                siteData = { ...siteData, ...result.record };
                renderAll();
            } catch (error) {
                console.error('Error loading data:', error);
                showToast('Gagal memuat data: ' + error.message, true);
            }
            hideLoading();
        }

        async function saveData() {
            showLoading();
            try {
                const response = await fetch(`https://api.jsonbin.io/v3/b/${CONFIG.BIN_ID}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': CONFIG.API_KEY
                    },
                    body: JSON.stringify(siteData)
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('Response error:', errorText);
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }
                
                const result = await response.json();
                console.log('Save success:', result);
                showToast('Data berhasil disimpan!');
                return true;
            } catch (error) {
                console.error('Error saving data:', error);
                showToast('Gagal menyimpan: ' + error.message, true);
                return false;
            } finally {
                hideLoading();
            }
        }

        // ==================== RENDER ALL ====================
        function renderAll() {
            renderStats();
            renderTentang();
            renderPengurusTable();
            renderKajianTable();
            renderKeuanganTable();
            renderZakatTable();
            renderKisahTable();
            renderGaleriTable();
            renderSerbiTable();
            renderPengaturan();
        }

        function renderStats() {
            document.getElementById('statPengurus').textContent = siteData.pengurus?.length || 0;
            document.getElementById('statKajian').textContent = siteData.kajian?.length || 0;
            document.getElementById('statGaleri').textContent = siteData.galeri?.length || 0;
            document.getElementById('statSerbi').textContent = siteData.serbaSerbi?.length || 0;
        }

        // ==================== MENU NAVIGATION ====================
        function initMenus() {
            document.querySelectorAll('.menu-item').forEach(item => {
                item.addEventListener('click', () => {
                    const page = item.dataset.page;
                    navigateTo(page);
                    closeSidebar();
                });
            });
        }

        function navigateTo(page) {
            document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
            document.querySelector(`[data-page="${page}"]`).classList.add('active');
            
            document.querySelectorAll('.page-section').forEach(s => s.classList.remove('active'));
            document.getElementById(`page-${page}`).classList.add('active');
            
            const titles = {
                dashboard: 'Dashboard',
                tentang: 'Tentang Masjid',
                pengurus: 'Kelola Pengurus',
                kajian: 'Jadwal Kajian',
                keuangan: 'Laporan Keuangan',
                zakat: 'Laporan Zakat',
                kisah: 'Kisah Inspiratif',
                galeri: 'Galeri',
                serbi: 'Serba Serbi',
                pengaturan: 'Pengaturan'
            };
            document.getElementById('pageTitle').textContent = titles[page] || page;
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
            document.getElementById('sidebarOverlay').classList.toggle('active');
        }

        function closeSidebar() {
            document.getElementById('sidebar').classList.remove('active');
            document.getElementById('sidebarOverlay').classList.remove('active');
        }

        // ==================== TENTANG ====================
        function renderTentang() {
            if (siteData.tentang) {
                document.getElementById('tentangDeskripsi').value = siteData.tentang.deskripsi || '';
                document.getElementById('tentangVisi').value = siteData.tentang.visi || '';
                renderMisiList(siteData.tentang.misi || []);
            }
        }

        function renderMisiList(misiArray) {
            const container = document.getElementById('misiList');
            container.innerHTML = '';
            
            if (misiArray.length === 0) {
                addMisiItem();
            } else {
                misiArray.forEach((misi) => {
                    addMisiItem(misi);
                });
            }
        }

        function addMisiItem(value = '') {
            const container = document.getElementById('misiList');
            const div = document.createElement('div');
            div.className = 'misi-input-item';
            div.innerHTML = `
                <input type="text" class="misi-input" value="${value}" placeholder="Tuliskan misi...">
                <button type="button" class="btn-remove" onclick="this.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            `;
            container.appendChild(div);
        }

        // ==================== PENGURUS ====================
        function renderPengurusTable() {
            const tbody = document.getElementById('pengurusTable');
            if (!siteData.pengurus || siteData.pengurus.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;padding:40px;color:#888;"><i class="fas fa-users" style="font-size:2rem;display:block;margin-bottom:10px;"></i>Belum ada data pengurus</td></tr>';
                return;
            }

            const kategoriLabels = {
                yayasan: 'Yayasan',
                dkm: 'DKM',
                majlistaklim: "Majlis Ta'lim"
            };

            tbody.innerHTML = siteData.pengurus.map((p, i) => `
                <tr>
                    <td><img src="${p.foto || 'https://via.placeholder.com/50?text=?'}" alt="${p.nama}" onerror="this.src='https://via.placeholder.com/50?text=?'"></td>
                    <td>${p.nama}</td>
                    <td>${p.jabatan}</td>
                    <td>${kategoriLabels[p.kategori] || p.kategori}</td>
                    <td class="actions">
                        <button class="btn btn-warning btn-sm" onclick="editPengurus(${i})"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-danger btn-sm" onclick="deletePengurus(${i})"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>
            `).join('');
        }

        function openPengurusModal(index = -1) {
            document.getElementById('pengurusIndex').value = index;
            document.getElementById('modalPengurusTitle').textContent = index === -1 ? 'Tambah Pengurus' : 'Edit Pengurus';
            
            if (index >= 0 && siteData.pengurus[index]) {
                const p = siteData.pengurus[index];
                document.getElementById('pengurusNama').value = p.nama;
                document.getElementById('pengurusJabatan').value = p.jabatan;
                document.getElementById('pengurusKategori').value = p.kategori;
                document.getElementById('pengurusFoto').value = p.foto || '';
            } else {
                document.getElementById('formPengurus').reset();
            }
            
            openModal('modalPengurus');
        }

        function editPengurus(index) {
            openPengurusModal(index);
        }

        async function savePengurus() {
            const index = parseInt(document.getElementById('pengurusIndex').value);
            const pengurus = {
                nama: document.getElementById('pengurusNama').value,
                jabatan: document.getElementById('pengurusJabatan').value,
                kategori: document.getElementById('pengurusKategori').value,
                foto: document.getElementById('pengurusFoto').value
            };

            if (!siteData.pengurus) siteData.pengurus = [];
            
            if (index >= 0) {
                siteData.pengurus[index] = pengurus;
            } else {
                siteData.pengurus.push(pengurus);
            }

            if (await saveData()) {
                closeModal('modalPengurus');
                renderPengurusTable();
                renderStats();
            }
        }

        async function deletePengurus(index) {
            if (confirm('Yakin ingin menghapus pengurus ini?')) {
                siteData.pengurus.splice(index, 1);
                if (await saveData()) {
                    renderPengurusTable();
                    renderStats();
                }
            }
        }

        // ==================== KAJIAN ====================
        function renderKajianTable() {
            const tbody = document.getElementById('kajianTable');
            if (!siteData.kajian || siteData.kajian.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;padding:40px;color:#888;"><i class="fas fa-book-open" style="font-size:2rem;display:block;margin-bottom:10px;"></i>Belum ada jadwal kajian</td></tr>';
                return;
            }

            tbody.innerHTML = siteData.kajian.map((k, i) => `
                <tr>
                    <td>${k.hari}</td>
                    <td>${k.waktu}</td>
                    <td>${k.tema}</td>
                    <td>${k.ustadz}</td>
                    <td>${k.link ? '<i class="fas fa-check" style="color:green;"></i>' : '-'}</td>
                    <td class="actions">
                        <button class="btn btn-warning btn-sm" onclick="editKajian(${i})"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-danger btn-sm" onclick="deleteKajian(${i})"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>
            `).join('');
        }

        function openKajianModal(index = -1) {
            document.getElementById('kajianIndex').value = index;
            document.getElementById('modalKajianTitle').textContent = index === -1 ? 'Tambah Kajian' : 'Edit Kajian';
            
            if (index >= 0 && siteData.kajian[index]) {
                const k = siteData.kajian[index];
                document.getElementById('kajianHari').value = k.hari;
                document.getElementById('kajianWaktu').value = k.waktu;
                document.getElementById('kajianTema').value = k.tema;
                document.getElementById('kajianUstadz').value = k.ustadz;
                document.getElementById('kajianLink').value = k.link || '';
            } else {
                document.getElementById('formKajian').reset();
            }
            
            openModal('modalKajian');
        }

        function editKajian(index) {
            openKajianModal(index);
        }

        async function saveKajian() {
            const index = parseInt(document.getElementById('kajianIndex').value);
            const kajian = {
                hari: document.getElementById('kajianHari').value,
                waktu: document.getElementById('kajianWaktu').value,
                tema: document.getElementById('kajianTema').value,
                ustadz: document.getElementById('kajianUstadz').value,
                link: document.getElementById('kajianLink').value
            };

            if (!siteData.kajian) siteData.kajian = [];
            
            if (index >= 0) {
                siteData.kajian[index] = kajian;
            } else {
                siteData.kajian.push(kajian);
            }

            if (await saveData()) {
                closeModal('modalKajian');
                renderKajianTable();
                renderStats();
            }
        }

        async function deleteKajian(index) {
            if (confirm('Yakin ingin menghapus jadwal kajian ini?')) {
                siteData.kajian.splice(index, 1);
                if (await saveData()) {
                    renderKajianTable();
                    renderStats();
                }
            }
        }

        // ==================== KEUANGAN ====================
        function renderKeuanganTable() {
            const tbody = document.getElementById('keuanganTable');
            if (!siteData.keuangan || siteData.keuangan.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;padding:40px;color:#888;"><i class="fas fa-wallet" style="font-size:2rem;display:block;margin-bottom:10px;"></i>Belum ada laporan keuangan</td></tr>';
                return;
            }

            tbody.innerHTML = siteData.keuangan.map((k, i) => {
                const saldoAkhir = (k.saldoAwal || 0) + (k.pemasukan || 0) - (k.pengeluaran || 0);
                return `
                    <tr>
                        <td>${k.periode}</td>
                        <td>${formatRupiah(k.saldoAwal || 0)}</td>
                        <td style="color: #11998e;">${formatRupiah(k.pemasukan || 0)}</td>
                        <td style="color: #eb3349;">${formatRupiah(k.pengeluaran || 0)}</td>
                        <td><strong>${formatRupiah(saldoAkhir)}</strong></td>
                        <td class="actions">
                            <button class="btn btn-warning btn-sm" onclick="editKeuangan(${i})"><i class="fas fa-edit"></i></button>
                            <button class="btn btn-danger btn-sm" onclick="deleteKeuangan(${i})"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function openKeuanganModal(index = -1) {
            document.getElementById('keuanganIndex').value = index;
            document.getElementById('modalKeuanganTitle').textContent = index === -1 ? 'Tambah Laporan Keuangan' : 'Edit Laporan Keuangan';
            
            document.getElementById('keuanganRincianMasuk').innerHTML = '';
            document.getElementById('keuanganRincianKeluar').innerHTML = '';
            
            if (index >= 0 && siteData.keuangan[index]) {
                const k = siteData.keuangan[index];
                document.getElementById('keuanganPeriode').value = k.periode;
                document.getElementById('keuanganSaldoAwal').value = k.saldoAwal || 0;
                
                if (k.rincianMasuk && k.rincianMasuk.length > 0) {
                    k.rincianMasuk.forEach(item => {
                        const parsed = parseRincianItem(item);
                        addRincianItem('keuanganRincianMasuk', parsed.keterangan, parsed.nominal);
                    });
                } else {
                    addRincianItem('keuanganRincianMasuk');
                }
                
                if (k.rincianKeluar && k.rincianKeluar.length > 0) {
                    k.rincianKeluar.forEach(item => {
                        const parsed = parseRincianItem(item);
                        addRincianItem('keuanganRincianKeluar', parsed.keterangan, parsed.nominal);
                    });
                } else {
                    addRincianItem('keuanganRincianKeluar');
                }
            } else {
                document.getElementById('keuanganPeriode').value = '';
                document.getElementById('keuanganSaldoAwal').value = 0;
                addRincianItem('keuanganRincianMasuk');
                addRincianItem('keuanganRincianKeluar');
            }
            
            updateKeuanganTotals();
            openModal('modalKeuangan');
        }

        function editKeuangan(index) {
            openKeuanganModal(index);
        }

        async function saveKeuangan() {
            const index = parseInt(document.getElementById('keuanganIndex').value);
            const saldoAwal = parseInt(document.getElementById('keuanganSaldoAwal').value) || 0;
            
            const rincianMasuk = getRincianItems('keuanganRincianMasuk');
            const rincianKeluar = getRincianItems('keuanganRincianKeluar');
            const pemasukan = calculateRincianTotal('keuanganRincianMasuk');
            const pengeluaran = calculateRincianTotal('keuanganRincianKeluar');

            const keuangan = {
                periode: document.getElementById('keuanganPeriode').value,
                saldoAwal: saldoAwal,
                pemasukan: pemasukan,
                pengeluaran: pengeluaran,
                rincianMasuk: rincianMasuk,
                rincianKeluar: rincianKeluar
            };

            if (!siteData.keuangan) siteData.keuangan = [];
            
            if (index >= 0) {
                siteData.keuangan[index] = keuangan;
            } else {
                siteData.keuangan.push(keuangan);
            }

            if (await saveData()) {
                closeModal('modalKeuangan');
                renderKeuanganTable();
            }
        }

        async function deleteKeuangan(index) {
            if (confirm('Yakin ingin menghapus laporan keuangan ini?')) {
                siteData.keuangan.splice(index, 1);
                if (await saveData()) {
                    renderKeuanganTable();
                }
            }
        }

        function updateKeuanganTotals() {
            const totalMasuk = calculateRincianTotal('keuanganRincianMasuk');
            const totalKeluar = calculateRincianTotal('keuanganRincianKeluar');
            const saldoAwal = parseInt(document.getElementById('keuanganSaldoAwal').value) || 0;
            const saldoAkhir = saldoAwal + totalMasuk - totalKeluar;

            document.getElementById('keuanganTotalMasuk').textContent = formatRupiah(totalMasuk);
            document.getElementById('keuanganTotalKeluar').textContent = formatRupiah(totalKeluar);
            document.getElementById('keuanganSaldoAkhir').textContent = formatRupiah(saldoAkhir);
        }

        // ==================== ZAKAT ====================
        function renderZakatTable() {
            const tbody = document.getElementById('zakatTable');
            if (!siteData.zakat || siteData.zakat.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;padding:40px;color:#888;"><i class="fas fa-hand-holding-heart" style="font-size:2rem;display:block;margin-bottom:10px;"></i>Belum ada laporan zakat</td></tr>';
                return;
            }

            tbody.innerHTML = siteData.zakat.map((z, i) => {
                const saldoAkhir = (z.saldoAwal || 0) + (z.pemasukan || 0) - (z.pengeluaran || 0);
                return `
                    <tr>
                        <td>${z.tahun}</td>
                        <td>${formatRupiah(z.saldoAwal || 0)}</td>
                        <td style="color: #11998e;">${formatRupiah(z.pemasukan || 0)}</td>
                        <td style="color: #eb3349;">${formatRupiah(z.pengeluaran || 0)}</td>
                        <td><strong>${formatRupiah(saldoAkhir)}</strong></td>
                        <td class="actions">
                            <button class="btn btn-warning btn-sm" onclick="editZakat(${i})"><i class="fas fa-edit"></i></button>
                            <button class="btn btn-danger btn-sm" onclick="deleteZakat(${i})"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function openZakatModal(index = -1) {
            document.getElementById('zakatIndex').value = index;
            document.getElementById('modalZakatTitle').textContent = index === -1 ? 'Tambah Laporan Zakat' : 'Edit Laporan Zakat';
            
            document.getElementById('zakatRincianMasuk').innerHTML = '';
            document.getElementById('zakatRincianKeluar').innerHTML = '';
            
            if (index >= 0 && siteData.zakat[index]) {
                const z = siteData.zakat[index];
                document.getElementById('zakatTahun').value = z.tahun;
                document.getElementById('zakatSaldoAwal').value = z.saldoAwal || 0;
                
                if (z.rincianMasuk && z.rincianMasuk.length > 0) {
                    z.rincianMasuk.forEach(item => {
                        const parsed = parseRincianItem(item);
                        addRincianItem('zakatRincianMasuk', parsed.keterangan, parsed.nominal);
                    });
                } else {
                    addRincianItem('zakatRincianMasuk');
                }
                
                if (z.rincianKeluar && z.rincianKeluar.length > 0) {
                    z.rincianKeluar.forEach(item => {
                        const parsed = parseRincianItem(item);
                        addRincianItem('zakatRincianKeluar', parsed.keterangan, parsed.nominal);
                    });
                } else {
                    addRincianItem('zakatRincianKeluar');
                }
            } else {
                document.getElementById('zakatTahun').value = '';
                document.getElementById('zakatSaldoAwal').value = 0;
                addRincianItem('zakatRincianMasuk');
                addRincianItem('zakatRincianKeluar');
            }
            
            updateZakatTotals();
            openModal('modalZakat');
        }

        function editZakat(index) {
            openZakatModal(index);
        }

        async function saveZakat() {
            const index = parseInt(document.getElementById('zakatIndex').value);
            const saldoAwal = parseInt(document.getElementById('zakatSaldoAwal').value) || 0;
            
            const rincianMasuk = getRincianItems('zakatRincianMasuk');
            const rincianKeluar = getRincianItems('zakatRincianKeluar');
            const pemasukan = calculateRincianTotal('zakatRincianMasuk');
            const pengeluaran = calculateRincianTotal('zakatRincianKeluar');

            const zakat = {
                tahun: document.getElementById('zakatTahun').value,
                saldoAwal: saldoAwal,
                pemasukan: pemasukan,
                pengeluaran: pengeluaran,
                rincianMasuk: rincianMasuk,
                rincianKeluar: rincianKeluar
            };

            if (!siteData.zakat) siteData.zakat = [];
            
            if (index >= 0) {
                siteData.zakat[index] = zakat;
            } else {
                siteData.zakat.push(zakat);
            }

            if (await saveData()) {
                closeModal('modalZakat');
                renderZakatTable();
            }
        }

        async function deleteZakat(index) {
            if (confirm('Yakin ingin menghapus laporan zakat ini?')) {
                siteData.zakat.splice(index, 1);
                if (await saveData()) {
                    renderZakatTable();
                }
            }
        }

        function updateZakatTotals() {
            const totalMasuk = calculateRincianTotal('zakatRincianMasuk');
            const totalKeluar = calculateRincianTotal('zakatRincianKeluar');
            const saldoAwal = parseInt(document.getElementById('zakatSaldoAwal').value) || 0;
            const saldoAkhir = saldoAwal + totalMasuk - totalKeluar;

            document.getElementById('zakatTotalMasuk').textContent = formatRupiah(totalMasuk);
            document.getElementById('zakatTotalKeluar').textContent = formatRupiah(totalKeluar);
            document.getElementById('zakatSaldoAkhir').textContent = formatRupiah(saldoAkhir);
        }

        // ==================== RINCIAN HELPERS ====================
        function addRincianItem(containerId, keterangan = '', nominal = 0) {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = 'rincian-item';
            
            const isKeuangan = containerId.includes('keuangan');
            const updateFunc = isKeuangan ? 'updateKeuanganTotals()' : 'updateZakatTotals()';
            
            div.innerHTML = `
                <input type="text" class="input-keterangan" value="${keterangan}" placeholder="Keterangan (contoh: Infaq Jumat)">
                <input type="number" class="input-nominal" value="${nominal}" placeholder="Nominal" oninput="${updateFunc}">
                <button type="button" class="btn-remove" onclick="removeRincianItem(this, '${containerId}')">
                    <i class="fas fa-times"></i>
                </button>
            `;
            container.appendChild(div);
        }

        function removeRincianItem(btn, containerId) {
            btn.parentElement.remove();
            
            if (containerId.includes('keuangan')) {
                updateKeuanganTotals();
            } else {
                updateZakatTotals();
            }
        }

        function getRincianItems(containerId) {
            const container = document.getElementById(containerId);
            const items = [];
            
            container.querySelectorAll('.rincian-item').forEach(item => {
                const keterangan = item.querySelector('.input-keterangan').value.trim();
                const nominal = parseInt(item.querySelector('.input-nominal').value) || 0;
                
                if (keterangan && nominal > 0) {
                    items.push(`${keterangan}: ${formatRupiah(nominal)}`);
                }
            });
            
            return items;
        }

        function calculateRincianTotal(containerId) {
            const container = document.getElementById(containerId);
            let total = 0;
            
            container.querySelectorAll('.rincian-item .input-nominal').forEach(input => {
                total += parseInt(input.value) || 0;
            });
            
            return total;
        }

        function parseRincianItem(itemStr) {
            const parts = itemStr.split(':');
            const keterangan = parts[0]?.trim() || '';
            let nominal = 0;
            
            if (parts[1]) {
                const nominalStr = parts[1].replace(/[Rp.\s]/g, '');
                nominal = parseInt(nominalStr) || 0;
            }
            
            return { keterangan, nominal };
        }

        // ==================== KISAH ====================
        function renderKisahTable() {
            const tbody = document.getElementById('kisahTable');
            if (!siteData.kisah || siteData.kisah.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;padding:40px;color:#888;"><i class="fas fa-star" style="font-size:2rem;display:block;margin-bottom:10px;"></i>Belum ada kisah inspiratif</td></tr>';
                return;
            }

            tbody.innerHTML = siteData.kisah.map((k, i) => `
                <tr>
                    <td><img src="${k.gambar || 'https://via.placeholder.com/50?text=?'}" alt="${k.judul}" onerror="this.src='https://via.placeholder.com/50?text=?'"></td>
                    <td>${k.judul}</td>
                    <td>${formatTanggal(k.tanggal)}</td>
                    <td class="actions">
                        <button class="btn btn-warning btn-sm" onclick="editKisah(${i})"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-danger btn-sm" onclick="deleteKisah(${i})"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>
            `).join('');
        }

        function openKisahModal(index = -1) {
            document.getElementById('kisahIndex').value = index;
            document.getElementById('modalKisahTitle').textContent = index === -1 ? 'Tambah Kisah' : 'Edit Kisah';
            
            if (index >= 0 && siteData.kisah[index]) {
                const k = siteData.kisah[index];
                document.getElementById('kisahJudul').value = k.judul;
                document.getElementById('kisahTanggal').value = k.tanggal;
                document.getElementById('kisahGambar').value = k.gambar || '';
                document.getElementById('kisahIsi').value = k.isi;
            } else {
                document.getElementById('formKisah').reset();
                document.getElementById('kisahTanggal').value = new Date().toISOString().split('T')[0];
            }
            
            openModal('modalKisah');
        }

        function editKisah(index) {
            openKisahModal(index);
        }

        async function saveKisah() {
            const index = parseInt(document.getElementById('kisahIndex').value);
            const kisah = {
                judul: document.getElementById('kisahJudul').value,
                tanggal: document.getElementById('kisahTanggal').value,
                gambar: document.getElementById('kisahGambar').value,
                isi: document.getElementById('kisahIsi').value
            };

            if (!siteData.kisah) siteData.kisah = [];
            
            if (index >= 0) {
                siteData.kisah[index] = kisah;
            } else {
                siteData.kisah.push(kisah);
            }

            if (await saveData()) {
                closeModal('modalKisah');
                renderKisahTable();
            }
        }

        async function deleteKisah(index) {
            if (confirm('Yakin ingin menghapus kisah ini?')) {
                siteData.kisah.splice(index, 1);
                if (await saveData()) {
                    renderKisahTable();
                }
            }
        }

        // ==================== GALERI ====================
        function renderGaleriTable() {
            const tbody = document.getElementById('galeriTable');
            if (!siteData.galeri || siteData.galeri.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;padding:40px;color:#888;"><i class="fas fa-images" style="font-size:2rem;display:block;margin-bottom:10px;"></i>Belum ada galeri</td></tr>';
                return;
            }

            const tipeIcons = {
                foto: '<i class="fas fa-image" style="color: #11998e;"></i> Foto',
                youtube: '<i class="fab fa-youtube" style="color: #ff0000;"></i> YouTube',
                instagram: '<i class="fab fa-instagram" style="color: #e1306c;"></i> Instagram',
                tiktok: '<i class="fab fa-tiktok"></i> TikTok'
            };

            tbody.innerHTML = siteData.galeri.map((g, i) => `
                <tr>
                    <td>${g.tipe === 'foto' ? `<img src="${g.url}" alt="Galeri" onerror="this.src='https://via.placeholder.com/50?text=?'">` : tipeIcons[g.tipe]}</td>
                    <td>${tipeIcons[g.tipe] || g.tipe}</td>
                    <td>${g.keterangan || '-'}</td>
                    <td class="actions">
                        <button class="btn btn-warning btn-sm" onclick="editGaleri(${i})"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-danger btn-sm" onclick="deleteGaleri(${i})"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>
            `).join('');
        }

        function openGaleriModal(index = -1) {
            document.getElementById('galeriIndex').value = index;
            document.getElementById('modalGaleriTitle').textContent = index === -1 ? 'Tambah Media' : 'Edit Media';
            
            if (index >= 0 && siteData.galeri[index]) {
                const g = siteData.galeri[index];
                document.getElementById('galeriTipe').value = g.tipe;
                document.getElementById('galeriUrl').value = g.url;
                document.getElementById('galeriKeterangan').value = g.keterangan || '';
            } else {
                document.getElementById('formGaleri').reset();
            }
            
            openModal('modalGaleri');
        }

        function editGaleri(index) {
            openGaleriModal(index);
        }

        async function saveGaleri() {
            const index = parseInt(document.getElementById('galeriIndex').value);
            const galeri = {
                tipe: document.getElementById('galeriTipe').value,
                url: document.getElementById('galeriUrl').value,
                keterangan: document.getElementById('galeriKeterangan').value
            };

            if (!siteData.galeri) siteData.galeri = [];
            
            if (index >= 0) {
                siteData.galeri[index] = galeri;
            } else {
                siteData.galeri.push(galeri);
            }

            if (await saveData()) {
                closeModal('modalGaleri');
                renderGaleriTable();
                renderStats();
            }
        }

        async function deleteGaleri(index) {
            if (confirm('Yakin ingin menghapus media ini?')) {
                siteData.galeri.splice(index, 1);
                if (await saveData()) {
                    renderGaleriTable();
                    renderStats();
                }
            }
        }

        // ==================== SERBA SERBI ====================
        function renderSerbiTable() {
            const tbody = document.getElementById('serbiTable');
            if (!siteData.serbaSerbi || siteData.serbaSerbi.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;padding:40px;color:#888;"><i class="fas fa-newspaper" style="font-size:2rem;display:block;margin-bottom:10px;"></i>Belum ada serba serbi</td></tr>';
                return;
            }

            tbody.innerHTML = siteData.serbaSerbi.map((s, i) => `
                <tr>
                    <td><img src="${s.gambar || 'https://via.placeholder.com/50?text=?'}" alt="${s.judul}" onerror="this.src='https://via.placeholder.com/50?text=?'"></td>
                    <td>${s.judul}</td>
                    <td>${formatTanggal(s.tanggal)}</td>
                    <td>${s.penting ? '<span style="background: #dc3545; color: white; padding: 3px 10px; border-radius: 20px; font-size: 0.75rem;">PENTING</span>' : '-'}</td>
                    <td class="actions">
                        <button class="btn btn-warning btn-sm" onclick="editSerbi(${i})"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-danger btn-sm" onclick="deleteSerbi(${i})"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>
            `).join('');
        }

        function openSerbiModal(index = -1) {
            document.getElementById('serbiIndex').value = index;
            document.getElementById('modalSerbiTitle').textContent = index === -1 ? 'Tambah Info' : 'Edit Info';
            
            if (index >= 0 && siteData.serbaSerbi[index]) {
                const s = siteData.serbaSerbi[index];
                document.getElementById('serbiJudul').value = s.judul;
                document.getElementById('serbiTanggal').value = s.tanggal;
                document.getElementById('serbiGambar').value = s.gambar || '';
                document.getElementById('serbiIsi').value = s.isi;
                document.getElementById('serbiPenting').checked = s.penting || false;
            } else {
                document.getElementById('formSerbi').reset();
                document.getElementById('serbiTanggal').value = new Date().toISOString().split('T')[0];
            }
            
            openModal('modalSerbi');
        }

        function editSerbi(index) {
            openSerbiModal(index);
        }

        async function saveSerbi() {
            const index = parseInt(document.getElementById('serbiIndex').value);
            const serbi = {
                judul: document.getElementById('serbiJudul').value,
                tanggal: document.getElementById('serbiTanggal').value,
                gambar: document.getElementById('serbiGambar').value,
                isi: document.getElementById('serbiIsi').value,
                penting: document.getElementById('serbiPenting').checked
            };

            if (!siteData.serbaSerbi) siteData.serbaSerbi = [];
            
            if (index >= 0) {
                siteData.serbaSerbi[index] = serbi;
            } else {
                siteData.serbaSerbi.push(serbi);
            }

            if (await saveData()) {
                closeModal('modalSerbi');
                renderSerbiTable();
                renderStats();
            }
        }

        async function deleteSerbi(index) {
            if (confirm('Yakin ingin menghapus info ini?')) {
                siteData.serbaSerbi.splice(index, 1);
                if (await saveData()) {
                    renderSerbiTable();
                    renderStats();
                }
            }
        }

        // ==================== PENGATURAN ====================
        function renderPengaturan() {
            if (siteData.pengaturan) {
                document.getElementById('pengaturanGambar').value = siteData.pengaturan.gambarMasjid || '';
                document.getElementById('pengaturanMap').value = siteData.pengaturan.mapEmbed || '';
                document.getElementById('pengaturanAlamat').value = siteData.pengaturan.alamat || '';
                document.getElementById('pengaturanBank').value = siteData.pengaturan.bank || '';
                document.getElementById('pengaturanRekening').value = siteData.pengaturan.rekening || '';
                document.getElementById('pengaturanAtasNama').value = siteData.pengaturan.atasNama || '';
            }
        }

        // ==================== FORMS ====================
        function initForms() {
            document.getElementById('formTentang').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const misiInputs = document.querySelectorAll('#misiList .misi-input');
                const misiArray = Array.from(misiInputs)
                    .map(input => input.value.trim())
                    .filter(val => val !== '');

                siteData.tentang = {
                    deskripsi: document.getElementById('tentangDeskripsi').value,
                    visi: document.getElementById('tentangVisi').value,
                    misi: misiArray
                };

                if (await saveData()) {
                    showToast('Data tentang masjid berhasil disimpan!');
                }
            });

            document.getElementById('formPengaturan').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                siteData.pengaturan = {
                    gambarMasjid: document.getElementById('pengaturanGambar').value,
                    mapEmbed: document.getElementById('pengaturanMap').value,
                    alamat: document.getElementById('pengaturanAlamat').value,
                    bank: document.getElementById('pengaturanBank').value,
                    rekening: document.getElementById('pengaturanRekening').value,
                    atasNama: document.getElementById('pengaturanAtasNama').value
                };

                if (await saveData()) {
                    showToast('Pengaturan berhasil disimpan!');
                }
            });

            document.getElementById('keuanganSaldoAwal').addEventListener('input', updateKeuanganTotals);
            document.getElementById('zakatSaldoAwal').addEventListener('input', updateZakatTotals);
        }

        // ==================== MODAL ====================
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
            document.body.style.overflow = '';
        }

        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('show');
                    document.body.style.overflow = '';
                }
            });
        });

        // ==================== UTILITIES ====================
        function formatRupiah(amount) {
            return 'Rp ' + amount.toLocaleString('id-ID');
        }

        function formatTanggal(dateStr) {
            if (!dateStr) return '-';
            const date = new Date(dateStr);
            const options = { day: 'numeric', month: 'long', year: 'numeric' };
            return date.toLocaleDateString('id-ID', options);
        }

        function showToast(message, isError = false) {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            
            toast.classList.remove('error');
            if (isError) {
                toast.classList.add('error');
            }
            
            toastMessage.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 4000);
        }

        function showLoading() {
            document.getElementById('loadingOverlay').classList.add('show');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('show');
        }
    </script>
</body>
</html>